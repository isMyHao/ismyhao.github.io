<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>PHP代码审计-弱类型 | Hao's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=undefined"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">PHP代码审计-弱类型</h1><a id="logo" href="/.">Hao's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">PHP代码审计-弱类型</h1><div class="post-meta">2025-10-11<span> | </span><span class="category"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP%E5%BC%B1%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">PHP弱类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%92%8C%E5%B8%83%E5%B0%94%E5%9E%8B%E6%AF%94%E8%BE%83"><span class="toc-number">1.0.1.</span> <span class="toc-text">1、和布尔型比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E5%8D%95%E5%BC%95%E5%8F%B70%E6%84%8F%E5%91%B3%E7%9D%80%E7%AD%89%E4%BA%8E%E7%A9%BA"><span class="toc-number">1.0.2.</span> <span class="toc-text">2，单引号0意味着等于空</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E2%80%980%E2%80%99%E7%AD%89%E4%BA%8E-%E2%80%98-%E2%80%99%E4%BA%8C%E8%80%85%E5%8F%88%E4%B8%8D%E7%9B%B8%E7%AD%89"><span class="toc-number">1.0.3.</span> <span class="toc-text">3、‘0’等于 ‘ ’二者又不相等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%810e%E5%BC%80%E5%A4%B4%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83hash%E5%80%BC%E6%AF%94%E8%BE%83"><span class="toc-number">1.0.4.</span> <span class="toc-text">4、0e开头的字符串比较hash值比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%810x%E5%BC%80%E5%A4%B4%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83"><span class="toc-number">1.0.5.</span> <span class="toc-text">5、0x开头的字符串比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81in-array"><span class="toc-number">1.0.6.</span> <span class="toc-text">6、in_array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81strcmp-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83-Ascii%E7%A0%81"><span class="toc-number">1.0.7.</span> <span class="toc-text">7、strcmp()字符串比较 -Ascii码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81MD5%E6%AF%94%E8%BE%83%E2%80%93%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6%E8%8B%9B%E5%88%BB"><span class="toc-number">1.0.8.</span> <span class="toc-text">8、MD5比较–利用条件苛刻</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81Json-decode%E7%9B%B8%E5%85%B3%E7%9A%84%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83"><span class="toc-number">1.0.9.</span> <span class="toc-text">9、Json_decode相关的弱类型比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81Array-search%E5%BC%B1%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.0.10.</span> <span class="toc-text">10、Array_search弱类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81Switch%E6%AF%94%E8%BE%83%E7%BC%BA%E9%99%B7"><span class="toc-number">1.0.11.</span> <span class="toc-text">11、Switch比较缺陷</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="PHP弱类型"><a href="#PHP弱类型" class="headerlink" title="PHP弱类型"></a>PHP弱类型</h1><p> &#x3D;&#x3D; 和 &#x3D;&#x3D;&#x3D; 的区别</p>
<p>强类型比较：&#x3D;&#x3D;&#x3D;<br>强类型比较在进行比较的时候，会先判断两种字符的类型是否相等，在比较数值</p>
<p>弱类型比较：&#x3D;&#x3D;<br><strong>弱类型比较在进行比较的时候，会先将字符串类型转换成相同的类型，再比较，中间有一个强转的过程（优先转换为数字类型）</strong> —重点</p>
<p>在弱比较（&#x3D;）如果比较一个数字和字符串 或者 比较涉及到数字内容的字符串，<strong>首个字符串值会被转换成数值</strong>，并按照数值来进行比较</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin&quot;</span>==<span class="number">0</span>); <span class="comment">//Ture</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;2admin&quot;</span>==<span class="number">1</span>); <span class="comment">//Flas</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin&quot;</span> == <span class="number">2</span>);<span class="comment">//Flas</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin&quot;</span> ==<span class="number">0</span>);<span class="comment">//True</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e123456&quot;</span>==<span class="string">&quot;0e654321&quot;</span>);<span class="comment">//True</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ul>
<li><p>当数字在前时后面的字母便会转换成数值型，为0</p>
</li>
<li><p>当字母在前，数字在后时字母将无法转换成数字型，会直接当成字符串类型</p>
</li>
</ul>
<h3 id="1、和布尔型比较"><a href="#1、和布尔型比较" class="headerlink" title="1、和布尔型比较"></a>1、和布尔型比较</h3><p>在布尔值之间进行比较的时候，0 和 ‘’ 空字符串，都代表false，<code>&#39;   &#39;</code>，非空的字符串，代表非false</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="number">0</span>==<span class="literal">false</span>);<span class="comment">//Ture</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;&#x27;</span>==<span class="literal">false</span>);<span class="comment">//True</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;     &#x27;</span>==<span class="literal">false</span>);<span class="comment">//False 有空格意味着非空</span></span><br></pre></td></tr></table></figure>

<h3 id="2，单引号0意味着等于空"><a href="#2，单引号0意味着等于空" class="headerlink" title="2，单引号0意味着等于空"></a>2，单引号0意味着等于空</h3><p>思考： 为什么会存在‘0’和 布尔值之间的比较</p>
<p>总结：’0’ 字符串’0’          “0”等于空等于false</p>
<h3 id="3、‘0’等于-‘-’二者又不相等"><a href="#3、‘0’等于-‘-’二者又不相等" class="headerlink" title="3、‘0’等于 ‘ ’二者又不相等"></a>3、‘0’等于 ‘ ’二者又不相等</h3><p>注意以前： ‘’ 引号里面没有内容，代表false， ‘0’引号里面有个0，也代表false</p>
<p>奇怪的特性死记硬背</p>
<blockquote>
<p>当‘0’单引号0和 别的数据相比较时，‘0’单引号0意味着等于‘’空 等于false<br>但是‘0’单引号和‘’空相比较时，他们二者又不相等</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;0&#x27;</span>==<span class="literal">false</span>);<span class="comment">//Ture   单引号‘0’ 意味着等于空，空等于false，所以结果为Ture</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;0&#x27;</span>);<span class="comment">//False     ‘’ 这个也等于空，‘0’这个也等于空，但是二者相比较时，二者又不相等，所以结果为False</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;0&#x27;</span> == <span class="number">0</span> <span class="comment">//true  </span></span><br><span class="line"><span class="string">&#x27;0&#x27;</span>==<span class="string">&#x27;&#x27;</span> <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<h3 id="4、0e开头的字符串比较hash值比较"><a href="#4、0e开头的字符串比较hash值比较" class="headerlink" title="4、0e开头的字符串比较hash值比较"></a>4、0e开头的字符串比较hash值比较</h3><p>在进行比较运算时，如果遇到了0e这类字符串，PHP会将它解析为科学计数法。</p>
<p>PHP它把每一个以”0E”开头的哈希值都解释为0，</p>
<p>如果两个不同的数据参数值经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e1234&quot;</span> == <span class="string">&quot;0e4567&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>哈希值0e开头的，不同密码值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>e开头的md5和原值：</span><br><span class="line">QNKCDZO</span><br><span class="line"><span class="number">0e830400451993494058024219903391</span></span><br><span class="line"><span class="number">240610708</span></span><br><span class="line"><span class="number">0e462097431906509019562988736854</span></span><br><span class="line">s878926199a</span><br><span class="line"><span class="number">0e545993274517709034328855841020</span></span><br><span class="line">s155964671a</span><br><span class="line"><span class="number">0e342768416822451524974117254469</span></span><br></pre></td></tr></table></figure>

<h3 id="5、0x开头的字符串比较"><a href="#5、0x开头的字符串比较" class="headerlink" title="5、0x开头的字符串比较"></a>5、0x开头的字符串比较</h3><p><strong>在进行比较运算时，如果遇到了0x这类字符串，PHP会将它解析为十六进制</strong></p>
<p>所谓的弱类型比较漏洞，也就在在进行比较判断下一步执行行为的时候，可以利用该漏洞，实现一个<br>最终结果为真的 一个 返回值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0x1046a&quot;</span> == <span class="string">&quot;66666&quot;</span> ); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="6、in-array"><a href="#6、in-array" class="headerlink" title="6、in_array"></a>6、in_array</h3><p>重点：函数搜索 比较的时候，是有可能存在弱类型比较漏洞的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="variable">$arr1</span> = <span class="keyword">array</span>(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;nihao&quot;</span>,<span class="string">&quot;wohao&quot;</span>) ;</span><br><span class="line">     <span class="variable">$brr1</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$brr1</span>,<span class="variable">$arr1</span>))&#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;在数组中&quot;</span>;</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;不在数组中&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment">//输出：在数组中</span></span><br></pre></td></tr></table></figure>

<p>关键在于in_array的第三个参数：</p>
<ul>
<li>true 代表&#x3D;&#x3D;&#x3D; 强类型比较</li>
<li>false 代表&#x3D;&#x3D; 弱类型比较</li>
</ul>
<p>默认为false</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="variable">$arr1</span> = <span class="keyword">array</span>(<span class="number">0</span>,<span class="string">&quot;nihao&quot;</span>,<span class="string">&quot;wohao&quot;</span>) ;</span><br><span class="line">     <span class="variable">$brr1</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$brr1</span>,<span class="variable">$arr1</span>))&#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;在数组中&quot;</span>;</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;不在数组中&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment">//输出：在数组中</span></span><br></pre></td></tr></table></figure>

<h3 id="7、strcmp-字符串比较-Ascii码"><a href="#7、strcmp-字符串比较-Ascii码" class="headerlink" title="7、strcmp()字符串比较 -Ascii码"></a>7、strcmp()字符串比较 -Ascii码</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">注意：此比较区分大小写</span><br><span class="line">用途：比较括号内的两个字符串string1和string2的大小</span><br><span class="line">语法：strcmp(string $string1, string $string2): int</span><br><span class="line">返回：</span><br><span class="line">            str1等于str2时候，返回0</span><br><span class="line">            str1大于str2时候，返回1</span><br><span class="line">            str1小于str2时候，返回-1</span><br><span class="line"></span><br><span class="line">略记： strcmp -二进制安全字符串比较</span><br></pre></td></tr></table></figure>

<p>在5.3及以后的php版本中，当strcmp()括号内是一个数组与字符串比较时，也会返回0。</p>
<p>结论：进行字符串进行比较的时候，比较的是，第1个字符的值，第1个字符的值，决定了整个比较结果</p>
<p>进行比较的时候，只比较字符串，只比较ascii码，含有特殊意义的字符，也只会被认为是字符，并不会具有特殊意义</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> =<span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="string">&#x27;dbc&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">strcmp</span>(<span class="variable">$a</span>,<span class="variable">$c</span>);<span class="comment">//-1</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$a</span> =<span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="string">&#x27;Abc&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">strcmp</span>(<span class="variable">$a</span>,<span class="variable">$c</span>);<span class="comment">//1</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$a</span> =<span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">strcmp</span>(<span class="variable">$a</span>,<span class="variable">$c</span>);<span class="comment">//0</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luolt42/article/details/132271911">ASCII码对照表</a></p>
<h3 id="8、MD5比较–利用条件苛刻"><a href="#8、MD5比较–利用条件苛刻" class="headerlink" title="8、MD5比较–利用条件苛刻"></a>8、MD5比较–利用条件苛刻</h3><p>注意：在进行 MD5 弱类型比较漏洞利用的时候，必须是对方也使用了MD5(数组)的情况下，才有可能利用成功</p>
<p>用途：计算字符串的 MD5 散列值</p>
<p>当你传递一个array时，md5()不会报错，只是会无法正确地求出array的md5值，返回null，<br>这样就会导致任意2个array的md5值都会相等。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&quot;abcde&quot;</span>);</span><br><span class="line">    <span class="variable">$b</span> = <span class="keyword">array</span>(<span class="string">&quot;qwerio&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;比较的值相等&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;比较的值不相等&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//输出：比较值相等</span></span><br></pre></td></tr></table></figure>

<h3 id="9、Json-decode相关的弱类型比较"><a href="#9、Json-decode相关的弱类型比较" class="headerlink" title="9、Json_decode相关的弱类型比较"></a>9、Json_decode相关的弱类型比较</h3><p>注意：变量不变量并不重要，重要的是，我们可以通过key，取到对应的值</p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-11%20231237.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//json_decode变量存在的证明</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&quot;ssss&quot;</span>;<span class="comment">//字符串类型的 4个s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//$b=&quot;ssss&quot; </span></span><br><span class="line">    <span class="comment">//   &#123;key1:value1, key2:value2,key3:value3&#125;</span></span><br><span class="line">    <span class="comment">// &#x27;xxx&#x27;  &quot;xxx&quot;</span></span><br><span class="line">    <span class="comment">//&quot;&#123;key1:value1&#125;&quot;  &#x27;&#123;key1:value1&#125;&#x27;</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">json_decode</span>(<span class="string">&#x27;&#123;&quot;b&quot;:&quot;ssssb&quot;&#125;&#x27;</span>); <span class="comment">// object 对象</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$a</span> === <span class="variable">$message</span>-&gt;b)<span class="comment">//&quot;ssss&quot;</span></span><br><span class="line">    &#123; <span class="comment">//强类型证明变量a的存在</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回值：obj  和 array 的证明</span></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$json_str</span> = <span class="string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3&#125;&#x27;</span>;</span><br><span class="line">    <span class="variable">$ret</span> =<span class="title function_ invoke__">json_decode</span>(<span class="variable">$json_str</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$ret</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&quot;admin&quot;</span>;<span class="comment">//1、这是程序要比较的值，这个值对于攻击者而言是不可知的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]))<span class="comment">//3、最终payload message=&#123;&quot;key&quot;:0&#125;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]);<span class="comment">//将json格式的key value，转换成变量$key=value ==&gt;  $message=sss</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$message</span>-&gt;key == <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$message</span>-&gt;key == <span class="variable">$a</span>)</span><br><span class="line">    &#123;<span class="comment">//2、但是没有关系，因为这里用的是两个等号，弱类型比较，只需要利用比较逻辑，就可以让其实现相等</span></span><br><span class="line">        <span class="comment">//也就是可以利用0==&quot;admin&quot;这种形式绕过</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;你比较的值二者相等&#x27;</span>;<span class="comment">//目的输出ok</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;失败&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：你比较的值二者相等</span></span><br></pre></td></tr></table></figure>

<h3 id="10、Array-search弱类型"><a href="#10、Array-search弱类型" class="headerlink" title="10、Array_search弱类型"></a>10、Array_search弱类型</h3><p>array_search — 在数组中搜索给定的值，如果成功则返回首个相应的键名，也是通过 &#x3D;&#x3D; 进行比较的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array</span> = <span class="keyword">array</span>(<span class="number">0</span> =&gt; <span class="string">&#x27;blue&#x27;</span>, <span class="number">1</span> =&gt; <span class="string">&#x27;red&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;green&#x27;</span>, <span class="number">3</span> =&gt; <span class="string">&#x27;red&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&#x27;green&#x27;</span>, <span class="variable">$array</span>); <span class="comment">// $key = 2;</span></span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&#x27;red&#x27;</span>, <span class="variable">$array</span>);   <span class="comment">// $key = 1;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">array</span>(<span class="string">&quot;a&quot;</span>=&gt;<span class="string">&quot;llll&quot;</span>,<span class="string">&quot;b&quot;</span>=&gt;<span class="number">0</span>,<span class="string">&quot;c&quot;</span>=&gt;<span class="string">&quot;blue&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;red&quot;</span>,<span class="variable">$a</span>); <span class="comment">//返回键名b</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$cmd</span>); ++<span class="variable">$i</span>)&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$cmd</span>[<span class="variable">$i</span>] === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">        <span class="keyword">die</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$cmd</span>[<span class="variable">$i</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$cmd</span>[<span class="variable">$i</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="string">&#x27;admin&#x27;</span>, <span class="variable">$cmd</span>) === <span class="number">0</span>)&#123; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;flag&#x27;</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;no, you failed&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//paylaod: cmd[]=0</span></span><br></pre></td></tr></table></figure>

<h3 id="11、Switch比较缺陷"><a href="#11、Switch比较缺陷" class="headerlink" title="11、Switch比较缺陷"></a>11、Switch比较缺陷</h3><p><strong>&#x2F;&#x2F;本质上switch 做了一个弱类型比较</strong> &#x2F;&#x2F;$a&#x3D;&#x3D;’hello’?</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//本质上switch 做了一个弱类型比较</span></span><br><span class="line"><span class="comment">//$a==&#x27;hello&#x27;</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$a</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;hello&#x27;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;没找到&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul></div><div class="post-nav"><a class="pre" href="/2025/10/11/php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/">PHP代码审计-变量覆盖</a><a class="next" href="/2025/10/09/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/">Java设计模式-桥接模式</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.jpg"/></a><p>所幸仍有光.</p><a class="info-icon" href="https://hackerhao.top" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/isMyHao" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Web%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/">Java Web常见漏洞</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">Java基础知识</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%AE%89%E5%85%A8/">Java安全</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Js%E5%AE%89%E5%85%A8/">Js安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">PHP代码审计</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E5%AE%89%E5%85%A8/">PHP安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Win%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">Win权限提升</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E6%8F%90%E6%9D%83/">linux提权</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AE%89%E5%85%A8/">云安全</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%8D%E6%9D%80/">免杀</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E7%BD%91/">内网</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">权限提升</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/">漏洞发现</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Java%E5%AE%89%E5%85%A8/" style="font-size: 15px;">Java安全</a> <a href="/tags/Js%E5%AE%89%E5%85%A8/" style="font-size: 15px;">Js安全</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 15px;">Java基础</a> <a href="/tags/PHP%E5%AE%89%E5%85%A8/" style="font-size: 15px;">PHP安全</a> <a href="/tags/Java-Web%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/" style="font-size: 15px;">Java Web常见漏洞</a> <a href="/tags/linux%E6%8F%90%E6%9D%83/" style="font-size: 15px;">linux提权</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 15px;">Java基础知识</a> <a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 15px;">PHP代码审计</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 15px;">代码审计</a> <a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="font-size: 15px;">云安全</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size: 15px;">内网</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size: 15px;">权限提升</a> <a href="/tags/Win%E6%8F%90%E5%8D%87/" style="font-size: 15px;">Win提升</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/" style="font-size: 15px;">漏洞发现</a> <a href="/tags/%E5%85%8D%E6%9D%80/" style="font-size: 15px;">免杀</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/10/13/php%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/">PHP代码审计-弱类型</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/12/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">PHP代码审计-反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/12/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/">PHP代码审计-伪协议</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/11/php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/">PHP代码审计-变量覆盖</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/11/php%E5%BC%B1%E7%B1%BB%E5%9E%8B/">PHP代码审计-弱类型</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/09/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/">Java设计模式-桥接模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/09/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">Java设计模式-适配器模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/09/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/">Java设计模式-建造者模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/06/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/">Java设计模式-原型模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/06/%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F/">Java设计模式-模板模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=undefined" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=undefined"><script type="text/javascript" src="/js/search.js?v=undefined"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="https://unpkg.com/canvas-nest.js/dist/canvas-nest.js"></script><script type="text/javascript" src="/js/love.js?v=undefined"></script><script type="text/javascript" src="/js/copycode.js?v=undefined" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=undefined"><link rel="stylesheet" type="text/css" href="/css/external.css?v=undefined"><script type="text/javascript" src="/js/codeblock-resizer.js?v=undefined"></script><script type="text/javascript" src="/js/smartresize.js?v=undefined"></script></div></body></html>